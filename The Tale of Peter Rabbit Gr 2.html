<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>The Tale of Peter Rabbit - Grade Two</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #f8f9fa;
      width: 100vw;
      height: 100vh;
    }
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      font-family: sans-serif;
    }
    #story {
      position: relative;
      width: 98vw;
      max-width: 1100px;
      margin: 0 auto;
      background: #fff;
      border-radius: 20px;
      padding: 2em 1em 2em 1em;
      box-sizing: border-box;
      min-height: 60vh;
      box-shadow: 0 4px 24px rgba(0,0,0,0.08);
      font-size: 2.1em;
      font-weight: bold;
      line-height: 1.3;
      color: #222;
      letter-spacing: 0.01em;
      word-break: break-word;
    }
    .uword {
      text-decoration: underline;
      cursor: pointer;
      transition: background 0.15s;
      border-radius: 0.2em;
      padding: 0 0.05em;
    }
    .uword.selected {
      background: #cce7ff;
      color: #1a237e;
      transition: background 0.1s;
    }
    .popup {
      position: absolute;
      z-index: 1000;
      background: #f4fbff;
      border: 2px solid #8ec6ff;
      border-radius: 1em;
      box-shadow: 0 6px 32px rgba(30,60,120,0.12);
      padding: 1.3em 1em 1.7em 1em;
      font-size: 2em;
      font-weight: bold;
      color: #0d223a;
      min-width: 60vw;
      max-width: calc(100% - 2em);
      box-sizing: border-box;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      flex-direction: column;
      align-items: stretch;
      width: calc(100% - 2em);
      pointer-events: auto;
    }
    .popup .close-btn {
      position: absolute;
      top: 0.6em;
      right: 1em;
      font-size: 1.1em;
      color: #1565c0;
      background: none;
      border: none;
      font-weight: bold;
      cursor: pointer;
      padding: 0.2em 0.6em;
      z-index: 10;
    }
    .popup .popup-word {
      text-align: center;
      font-size: 2.2em;
      font-weight: bold;
      margin-bottom: 0.3em;
      color: #1456a0;
      width: 100%;
      word-break: break-word;
    }
    .popup .popup-definition {
      text-align: center;
      font-size: 1.15em;
      font-weight: bold;
      margin-bottom: 0.5em;
      width: 100%;
    }
    .popup .popup-sentence {
      text-align: center;
      font-size: 1em;
      font-weight: bold;
      margin-bottom: 0.7em;
      width: 100%;
      color: #1a237e;
    }
    .popup .popup-examples {
      width: 100%;
      margin-top: 0.5em;
      display: flex;
      flex-direction: column;
      gap: 0.3em;
    }
    .popup .popup-examples .example {
      text-align: left;
      font-size: 0.92em;
      font-weight: bold;
      color: #174b7b;
      width: 100%;
      margin-left: 0.8em;
      margin-bottom: 0.1em;
    }
    .popup .popup-definitions-list {
      width: 100%;
      max-height: 10em;
      overflow-y: auto;
      margin-top: 0.7em;
      margin-bottom: 0.5em;
      display: flex;
      flex-direction: column;
      gap: 0.5em;
    }
    .popup .popup-def-item {
      background: #e3f2fd;
      border-radius: 0.5em;
      padding: 0.5em 0.7em;
      font-size: 1em;
      font-weight: bold;
      color: #0d223a;
      cursor: pointer;
      text-align: center;
      transition: background 0.12s;
    }
    .popup .popup-def-item:hover, .popup .popup-def-item.selected {
      background: #bbdefb;
      color: #0d223a;
    }
    .popup .popup-prompt {
      text-align: center;
      font-size: 1em;
      font-weight: bold;
      color: #1a237e;
      margin-bottom: 0.7em;
    }
    @media (max-width: 700px) {
      #story {
        font-size: 2em;
        padding: 1em 0.2em 1em 0.2em;
      }
      .popup {
        font-size: 1.45em;
        min-width: 90vw;
        width: calc(100% - 2em);
        padding: 1em 0.2em 1.2em 0.2em;
      }
      .popup .popup-word { font-size: 1.5em; }
    }
  </style>
</head>
<body>
  <div id="story">
    <span class="uword" data-word="Peter">Peter</span> <span class="uword" data-word="hopped">hopped</span> <span class="uword" data-word="in" data-prep="in">in</span> <span class="uword" data-word="the">the</span> <span class="uword" data-word="garden">garden</span>, <span class="uword" data-word="looking">looking</span> <span class="uword" data-word="for">for</span> <span class="uword" data-word="something">something</span> <span class="uword" data-word="to">to</span> <span class="uword" data-word="eat">eat</span>. 
    <span class="uword" data-word="He">He</span> <span class="uword" data-word="squeezed">squeezed</span> <span class="uword" data-word="under">under</span> <span class="uword" data-word="the">the</span> <span class="uword" data-word="gate">gate</span>, <span class="uword" data-word="hoping">hoping</span> <span class="uword" data-word="to">to</span> <span class="uword" data-word="find">find</span> <span class="uword" data-word="a">a</span> <span class="uword" data-word="snack">snack</span>. 
    <span class="uword" data-word="A">A</span> <span class="uword" data-word="row">row</span> <span class="uword" data-word="of" data-prep="of">of</span> <span class="uword" data-word="carrots">carrots</span> <span class="uword" data-word="grew">grew</span> <span class="uword" data-word="in" data-prep="in">in</span> <span class="uword" data-word="the">the</span> <span class="uword" data-word="soft">soft</span> <span class="uword" data-word="dirt">dirt</span>, <span class="uword" data-word="bright">bright</span> <span class="uword" data-word="in" data-prep="in">in</span> <span class="uword" data-word="the">the</span> <span class="uword" data-word="morning">morning</span> <span class="uword" data-word="sun">sun</span>. 
    <span class="uword" data-word="Peter">Peter</span> <span class="uword" data-word="nibbled">nibbled</span> <span class="uword" data-word="on" data-prep="on">on</span> <span class="uword" data-word="a">a</span> <span class="uword" data-word="leaf">leaf</span>, <span class="uword" data-word="feeling">feeling</span> <span class="uword" data-word="happy">happy</span> <span class="uword" data-word="in" data-prep="in">in</span> <span class="uword" data-word="the">the</span> <span class="uword" data-word="cool">cool</span> <span class="uword" data-word="shade">shade</span>. 
    <span class="uword" data-word="He">He</span> <span class="uword" data-word="saw">saw</span> <span class="uword" data-word="a">a</span> <span class="uword" data-word="big">big</span> <span class="uword" data-word="cat">cat</span> <span class="uword" data-word="sitting">sitting</span> <span class="uword" data-word="on" data-prep="on">on</span> <span class="uword" data-word="a">a</span> <span class="uword" data-word="wall">wall</span>, <span class="uword" data-word="watching">watching</span> <span class="uword" data-word="him">him</span> <span class="uword" data-word="from">from</span> <span class="uword" data-word="above">above</span>. 
    <span class="uword" data-word="Peter">Peter</span> <span class="uword" data-word="moved">moved</span> <span class="uword" data-word="past">past</span> <span class="uword" data-word="the">the</span> <span class="uword" data-word="cat">cat</span>, <span class="uword" data-word="careful">careful</span> <span class="uword" data-word="not">not</span> <span class="uword" data-word="to">to</span> <span class="uword" data-word="make">make</span> <span class="uword" data-word="a">a</span> <span class="uword" data-word="sound">sound</span>. 
    <span class="uword" data-word="He">He</span> <span class="uword" data-word="tiptoed">tiptoed</span> <span class="uword" data-word="behind">behind</span> <span class="uword" data-word="a">a</span> <span class="uword" data-word="bush">bush</span>, <span class="uword" data-word="hiding">hiding</span> <span class="uword" data-word="from">from</span> <span class="uword" data-word="the">the</span> <span class="uword" data-word="gardener">gardener</span>. 
    <span class="uword" data-word="A">A</span> <span class="uword" data-word="bird">bird</span> <span class="uword" data-word="sang">sang</span> <span class="uword" data-word="on" data-prep="on">on</span> <span class="uword" data-word="a">a</span> <span class="uword" data-word="branch">branch</span>, <span class="uword" data-word="filling">filling</span> <span class="uword" data-word="the">the</span> <span class="uword" data-word="air">air</span> <span class="uword" data-word="with">with</span> <span class="uword" data-word="sweet">sweet</span> <span class="uword" data-word="music">music</span>. 
    <span class="uword" data-word="Peter">Peter</span> <span class="uword" data-word="hurried">hurried</span> <span class="uword" data-word="through">through</span> <span class="uword" data-word="the">the</span> <span class="uword" data-word="rows">rows</span>, <span class="uword" data-word="dreaming">dreaming</span> <span class="uword" data-word="of" data-prep="of">of</span> <span class="uword" data-word="home">home</span> <span class="uword" data-word="and">and</span> <span class="uword" data-word="safety">safety</span>.
  </div>
  <script>
    // Jason dictionary for prepositions (from attached file)
    const JASON_PREPOSITIONS = {
      "to": [
        {def: "the direction of", examples: [
          "We go to school every day.",
          "She walks to the store.",
          "Give the toy to your friend.",
          "The dog ran to the door.",
          "He pointed to the sky.",
          "Mom drove to work."
        ]},
        {def: "as far", examples: [
          "Walk to the end of the street.",
          "Run to the big tree.",
          "She read to page ten.",
          "Draw a line to the corner.",
          "We played to the last minute.",
          "He jumped to the top step."
        ]},
        {def: "until or up to a time", examples: [
          "Wait to the bell rings.",
          "Stay here to five o'clock.",
          "She worked to lunchtime.",
          "I will sleep to morning.",
          "Read to the end of the story.",
          "We can play to dinner."
        ]},
        {def: "touching or leaning against something", examples: [
          "The bike is leaning to the wall.",
          "She pressed her ear to the door.",
          "Put your hand to your heart.",
          "He glued the paper to the board.",
          "The puppy snuggled to my leg.",
          "The sign was nailed to the tree."
        ]},
        {def: "for the purpose of", examples: [
          "She went to the store to buy milk.",
          "He called to ask a question.",
          "We study to learn.",
          "They ran to catch the bus.",
          "I came to help you.",
          "She smiled to show she was happy."
        ]},
        {def: "related to or causing something", examples: [
          "The noise led to a complaint.",
          "His hard work led to success.",
          "Rain can lead to flooding.",
          "A cold can lead to a cough.",
          "The story led to laughter.",
          "The mistake led to a new idea."
        ]},
        {def: "alongside or belonging with something", examples: [
          "The answer is next to the question.",
          "The picture belongs to the book.",
          "The key is to the lock.",
          "The shoes are to the outfit.",
          "The lid is to the jar.",
          "The leash is to the dog."
        ]},
        {def: "showing how two things are similar or different", examples: [
          "Ice is cold compared to fire.",
          "My bag is bigger to yours.",
          "This book is easy to that one.",
          "The red car is fast to the blue one.",
          "Math is hard to some kids.",
          "Summer is hot to winter."
        ]},
        {def: "in agreement with", examples: [
          "She is true to her word.",
          "He acted to the rules.",
          "The answer is right to the teacher.",
          "I will be kind to my friends.",
          "We listened to the leader.",
          "She played to the plan."
        ]},
        {def: "in or for each", examples: [
          "There are five apples to each basket.",
          "Two students to a desk.",
          "One cookie to every child.",
          "Ten points to a game.",
          "Four wheels to a car.",
          "Three books to a shelf."
        ]},
        {def: "showing who is receiving something", examples: [
          "Give the letter to Sam.",
          "She handed the toy to her brother.",
          "Pass the salt to me.",
          "Send the gift to your friend.",
          "The teacher gave homework to the class.",
          "I told the story to my mom."
        ]}
      ],
      "of": [
        {def: "coming from", examples: [
          "The smell of cookies is nice.",
          "A cup of water is on the table.",
          "The sound of music filled the room.",
          "A piece of cake for you.",
          "A group of kids played outside.",
          "A bag of apples is heavy."
        ]},
        {def: "resulting from", examples: [
          "The joy of winning is great.",
          "The pain of falling hurt.",
          "The fun of playing is the best.",
          "The noise of cars is loud.",
          "The mess of painting is big.",
          "The taste of candy is sweet."
        ]},
        {def: "at a distance from", examples: [
          "The school is east of my house.",
          "The park is north of the library.",
          "The cat is far of the door.",
          "The tree is left of the bench.",
          "The ball is right of the chair.",
          "The store is south of the station."
        ]},
        {def: "by", examples: [
          "A book of poems by Maya.",
          "A painting of the artist.",
          "A song of the singer.",
          "A letter of my friend.",
          "A story of the writer.",
          "A drawing of the child."
        ]},
        {def: "separated from", examples: [
          "A piece of the puzzle is missing.",
          "A part of the cake was eaten.",
          "A slice of bread is on the plate.",
          "A bit of the toy broke.",
          "A drop of water fell.",
          "A chunk of ice melted."
        ]},
        {def: "taken out of a group or a whole number", examples: [
          "Three of the five dogs barked.",
          "Half of the class left early.",
          "Most of the apples are red.",
          "Some of the kids are tall.",
          "Many of the books are new.",
          "One of the cars is blue."
        ]},
        {def: "made from", examples: [
          "A shirt of cotton feels soft.",
          "A table of wood is strong.",
          "A ring of gold is shiny.",
          "A cup of glass is clear.",
          "A hat of straw is light.",
          "A blanket of wool is warm."
        ]},
        {def: "belonging to", examples: [
          "The toys of the children are everywhere.",
          "The books of the library are old.",
          "The keys of the car are lost.",
          "The name of the school is long.",
          "The songs of the birds are pretty.",
          "The color of the sky is blue."
        ]},
        {def: "having or owning", examples: [
          "A girl of many talents.",
          "A man of great strength.",
          "A dog of quick speed.",
          "A team of good players.",
          "A house of many rooms.",
          "A boy of kind heart."
        ]},
        {def: "including", examples: [
          "The bag of candy has gum, too.",
          "The box of toys has cars and dolls.",
          "The list of chores has sweeping.",
          "The set of crayons has red and blue.",
          "The class of students has boys and girls.",
          "The team of players has new members."
        ]},
        {def: "that is", examples: [
          "The city of Paris is in France.",
          "The month of June is hot.",
          "The animal of the year is the tiger.",
          "The color of the day is yellow.",
          "The book of the week is fun.",
          "The food of the day is pizza."
        ]},
        {def: "about or concerning", examples: [
          "The story of the hero is exciting.",
          "The talk of the weather was long.",
          "The lesson of math is hard.",
          "The news of the day is sad.",
          "The question of the test is tricky.",
          "The problem of the puzzle is tough."
        ]},
        {def: "during", examples: [
          "The fun of summer is swimming.",
          "The joy of holidays is gifts.",
          "The work of the day is done.",
          "The games of recess are fun.",
          "The study of night is quiet.",
          "The sleep of winter is deep."
        ]},
        {def: "before a certain time", examples: [
          "The end of the week is Friday.",
          "The start of the day is morning.",
          "The close of school is June.",
          "The finish of the race is near.",
          "The last of the month is coming.",
          "The close of class is soon."
        ]}
      ],
      "in": [
        {def: "inside or surrounded by something", examples: [
          "The cat is in the box.",
          "Put the book in your bag.",
          "There is milk in the cup.",
          "The ball is in the basket.",
          "He is in the room.",
          "The dog sleeps in the bed."
        ]},
        {def: "during or after", examples: [
          "In the morning, we eat breakfast.",
          "We play in the afternoon.",
          "The stars come out in the night.",
          "She reads in the evening.",
          "We swim in the summer.",
          "It snows in the winter."
        ]},
        {def: "not beyond or not past", examples: [
          "Finish your work in ten minutes.",
          "Come back in an hour.",
          "We will leave in five days.",
          "The movie starts in a minute.",
          "I will be home in a while.",
          "He will call in a moment."
        ]},
        {def: "part of a group or category", examples: [
          "She is in the soccer team.",
          "He is in the choir.",
          "I am in the third grade.",
          "We are in the same class.",
          "The book is in the library.",
          "The painting is in the museum."
        ]},
        {def: "using something as a tool or method", examples: [
          "Write your answer in pencil.",
          "Say it in a loud voice.",
          "Draw in color.",
          "Explain in simple words.",
          "Sing in English.",
          "Count in twos."
        ]},
        {def: "because of", examples: [
          "He was late in traffic.",
          "She cried in pain.",
          "The team won in excitement.",
          "He laughed in surprise.",
          "She smiled in joy.",
          "They cheered in happiness."
        ]},
        {def: "moving inside something", examples: [
          "The fish swam in the water.",
          "The car drove in the tunnel.",
          "The bird flew in the sky.",
          "The kids ran in the gym.",
          "The train moves in the city.",
          "The dog ran in the field."
        ]}
      ],
      "on": [
        {def: "resting or attached to something", examples: [
          "The book is on the table.",
          "Put your shoes on the floor.",
          "The cat sits on the chair.",
          "The hat is on my head.",
          "The picture is on the wall.",
          "The cup is on the desk."
        ]},
        {def: "on the surface of", examples: [
          "The leaf is on the water.",
          "The bug is on the window.",
          "The snow is on the roof.",
          "The paint is on the paper.",
          "The crumbs are on the plate.",
          "The sticker is on the box."
        ]},
        {def: "next to or beside something", examples: [
          "Sit on my right.",
          "The dog is on my left.",
          "The lamp is on the side of the bed.",
          "The pen is on the edge of the desk.",
          "The shoes are on the side of the door.",
          "The bag is on the side of the chair."
        ]},
        {def: "at the time something happens", examples: [
          "On Monday, we have art class.",
          "The party is on my birthday.",
          "We go to the park on weekends.",
          "On holidays, we visit family.",
          "On rainy days, we stay inside.",
          "On the first day of school, we meet our teacher."
        ]},
        {def: "related to something", examples: [
          "She gave a talk on science.",
          "The book is on animals.",
          "We worked on a project.",
          "He wrote a story on friendship.",
          "The lesson is on math.",
          "They watched a movie on space."
        ]}
      ]
    };

    // Definitions and examples for all other words in the story (non-prepositions, simple, bold, 6 examples, 4th grade or below)
    const SIMPLE_DICTIONARY = {
      "Peter": {
        def: "The name of the rabbit in the story.",
        ex: [
          "Peter is a rabbit.",
          "Peter likes to hop.",
          "Peter is looking for food.",
          "Peter saw a cat.",
          "Peter nibbled on a leaf.",
          "Peter hurried home."
        ]
      },
      "hopped": {
        def: "Jumped with both feet off the ground.",
        ex: [
          "The frog hopped away.",
          "She hopped over the rock.",
          "The bunny hopped in the grass.",
          "He hopped to the door.",
          "The bird hopped on the branch.",
          "We hopped in a line."
        ]
      },
      "the": {
        def: "Used to talk about a specific person, place, or thing.",
        ex: [
          "The dog barked.",
          "She found the book.",
          "The sun is bright.",
          "He opened the door.",
          "The cat is black.",
          "The apple is red."
        ]
      },
      "garden": {
        def: "A place where plants, flowers, or vegetables grow.",
        ex: [
          "We have a garden at home.",
          "The garden has red flowers.",
          "He picked carrots in the garden.",
          "The garden is green.",
          "Birds sing in the garden.",
          "I help water the garden."
        ]
      },
      "looking": {
        def: "Trying to see or find something.",
        ex: [
          "She is looking for her hat.",
          "I am looking at the sky.",
          "He is looking at the book.",
          "We are looking for the cat.",
          "They are looking for food.",
          "Are you looking at me?"
        ]
      },
      "for": {
        def: "Trying to get or find something.",
        ex: [
          "I am looking for my shoes.",
          "She is waiting for her friend.",
          "He looks for his dog.",
          "We search for answers.",
          "They ask for help.",
          "Can you look for my pen?"
        ]
      },
      "something": {
        def: "An unknown or unnamed thing.",
        ex: [
          "I want something to eat.",
          "She found something new.",
          "He heard something outside.",
          "There is something in the box.",
          "We saw something funny.",
          "Do you see something?"
        ]
      },
      "eat": {
        def: "To put food in your mouth and swallow it.",
        ex: [
          "I like to eat apples.",
          "She will eat lunch.",
          "He eats breakfast every day.",
          "We eat together.",
          "They eat pizza on Fridays.",
          "Can you eat your food?"
        ]
      },
      "He": {
        def: "A word for a boy or a man.",
        ex: [
          "He is my friend.",
          "He likes to run.",
          "He saw a bird.",
          "He is happy.",
          "He can jump.",
          "He is tall."
        ]
      },
      "squeezed": {
        def: "Pressed or moved through a small space.",
        ex: [
          "She squeezed the orange.",
          "He squeezed through the door.",
          "The mouse squeezed into a hole.",
          "I squeezed my hand.",
          "He squeezed past the chair.",
          "She squeezed the sponge."
        ]
      },
      "under": {
        def: "Below or beneath something.",
        ex: [
          "The cat is under the table.",
          "He hid under the bed.",
          "Put your shoes under the chair.",
          "The dog sleeps under the tree.",
          "She found her toy under the couch.",
          "The ball rolled under the car."
        ]
      },
      "gate": {
        def: "A door in a fence or wall.",
        ex: [
          "Open the gate.",
          "The gate is closed.",
          "He walked through the gate.",
          "The garden has a gate.",
          "She locked the gate.",
          "The gate is red."
        ]
      },
      "hoping": {
        def: "Wanting something good to happen.",
        ex: [
          "I am hoping for a sunny day.",
          "She is hoping to win.",
          "He is hoping for a snack.",
          "We are hoping to play.",
          "They are hoping for fun.",
          "Are you hoping for a gift?"
        ]
      },
      "find": {
        def: "To discover or get something that was lost or wanted.",
        ex: [
          "I want to find my shoes.",
          "She will find her book.",
          "He can find the answer.",
          "We find shells at the beach.",
          "They find food in the garden.",
          "Can you find my hat?"
        ]
      },
      "a": {
        def: "Used to mean one of something.",
        ex: [
          "I have a cat.",
          "She saw a dog.",
          "He ate a snack.",
          "We have a car.",
          "They saw a bird.",
          "Can I have a cookie?"
        ]
      },
      "snack": {
        def: "A small amount of food eaten between meals.",
        ex: [
          "I had a snack after school.",
          "She ate a snack before dinner.",
          "He likes chips for a snack.",
          "We brought a snack to the park.",
          "They shared a snack.",
          "Do you want a snack?"
        ]
      },
      "row": {
        def: "A line of things or people, one after another.",
        ex: [
          "The chairs are in a row.",
          "He planted a row of flowers.",
          "There is a row of trees.",
          "We sat in a row.",
          "The cars are in a row.",
          "She drew a row of stars."
        ]
      },
      "carrots": {
        def: "Orange vegetables that grow in the ground.",
        ex: [
          "Rabbits like carrots.",
          "She eats carrots for lunch.",
          "Carrots are orange.",
          "He picked carrots from the garden.",
          "We put carrots in the soup.",
          "Do you like carrots?"
        ]
      },
      "grew": {
        def: "Became bigger or developed.",
        ex: [
          "The plant grew tall.",
          "He grew fast.",
          "The tree grew in the yard.",
          "She grew carrots in the garden.",
          "The baby grew strong.",
          "Flowers grew in spring."
        ]
      },
      "soft": {
        def: "Easy to press or not hard.",
        ex: [
          "The pillow is soft.",
          "She has soft hair.",
          "The bed is soft.",
          "He touched the soft blanket.",
          "The kitten is soft.",
          "The bread is soft."
        ]
      },
      "dirt": {
        def: "Soil or earth on the ground.",
        ex: [
          "The dirt is brown.",
          "Plants grow in dirt.",
          "He played in the dirt.",
          "The dog dug in the dirt.",
          "She found a worm in the dirt.",
          "My shoes are dirty from the dirt."
        ]
      },
      "bright": {
        def: "Giving a lot of light or color.",
        ex: [
          "The sun is bright.",
          "She wore a bright shirt.",
          "The room is bright.",
          "He likes bright colors.",
          "The stars are bright at night.",
          "The light is bright."
        ]
      },
      "morning": {
        def: "The early part of the day.",
        ex: [
          "I wake up in the morning.",
          "She eats breakfast in the morning.",
          "It is sunny in the morning.",
          "He goes to school in the morning.",
          "Birds sing in the morning.",
          "The morning is cool."
        ]
      },
      "sun": {
        def: "The big bright star in the sky that gives us light and warmth.",
        ex: [
          "The sun is yellow.",
          "The sun shines in the sky.",
          "We play in the sun.",
          "The sun rises in the morning.",
          "The sun is hot.",
          "The sun sets at night."
        ]
      },
      "nibbled": {
        def: "Ate something by taking small bites.",
        ex: [
          "The mouse nibbled cheese.",
          "She nibbled on a cookie.",
          "He nibbled the apple.",
          "The rabbit nibbled a leaf.",
          "Birds nibbled seeds.",
          "I nibbled my snack."
        ]
      },
      "leaf": {
        def: "A flat, green part of a plant or tree.",
        ex: [
          "The leaf is green.",
          "She picked up a leaf.",
          "Leaves fall in autumn.",
          "The tree has many leaves.",
          "A bug sat on the leaf.",
          "He drew a leaf."
        ]
      },
      "feeling": {
        def: "Having a sense or emotion.",
        ex: [
          "I am feeling happy.",
          "She is feeling sad.",
          "He is feeling tired.",
          "We are feeling excited.",
          "They are feeling cold.",
          "Are you feeling okay?"
        ]
      },
      "happy": {
        def: "Glad or joyful.",
        ex: [
          "I am happy today.",
          "She is happy with her toy.",
          "He feels happy when he plays.",
          "We are happy at the party.",
          "They look happy.",
          "The dog is happy."
        ]
      },
      "cool": {
        def: "A little cold in a nice way.",
        ex: [
          "The water is cool.",
          "It is cool in the shade.",
          "The wind feels cool.",
          "She drank cool juice.",
          "The room is cool.",
          "He wears a cool hat."
        ]
      },
      "shade": {
        def: "A dark area where the sun does not shine.",
        ex: [
          "We sat in the shade.",
          "The tree gives shade.",
          "It is cool in the shade.",
          "The dog sleeps in the shade.",
          "She reads in the shade.",
          "The cat hid in the shade."
        ]
      },
      "saw": {
        def: "Looked at or noticed something.",
        ex: [
          "I saw a bird.",
          "She saw a rainbow.",
          "He saw his friend.",
          "We saw the sun.",
          "They saw a cat.",
          "Did you see the dog?"
        ]
      },
      "big": {
        def: "Large in size.",
        ex: [
          "The dog is big.",
          "She has a big hat.",
          "The house is big.",
          "He saw a big cat.",
          "The tree is big.",
          "The box is big."
        ]
      },
      "cat": {
        def: "A small animal with fur, whiskers, and a tail.",
        ex: [
          "The cat is black.",
          "She has a pet cat.",
          "The cat chased a mouse.",
          "He saw a cat on the wall.",
          "Cats like to sleep.",
          "The cat meowed."
        ]
      },
      "sitting": {
        def: "Resting with your bottom on something.",
        ex: [
          "She is sitting on a chair.",
          "The cat is sitting on the mat.",
          "He is sitting in the car.",
          "They are sitting at the table.",
          "I am sitting on the floor.",
          "The dog is sitting by the door."
        ]
      },
      "wall": {
        def: "A flat, upright surface that forms a side of a room or building.",
        ex: [
          "The picture is on the wall.",
          "He painted the wall.",
          "The wall is tall.",
          "She leaned on the wall.",
          "The cat sat on the wall.",
          "The wall is white."
        ]
      },
      "watching": {
        def: "Looking at something for a time.",
        ex: [
          "She is watching TV.",
          "He is watching the birds.",
          "They are watching a movie.",
          "I am watching the game.",
          "The cat is watching the mouse.",
          "We are watching the sky."
        ]
      },
      "him": {
        def: "A word for a boy or a man.",
        ex: [
          "I gave him a book.",
          "She called him.",
          "He saw him at school.",
          "We like him.",
          "They help him.",
          "Can you see him?"
        ]
      },
      "from": {
        def: "Starting at a place, time, or person.",
        ex: [
          "I got a gift from my friend.",
          "She is from Canada.",
          "He ran from the house.",
          "We walked from school.",
          "They come from far away.",
          "The bird flew from the tree."
        ]
      },
      "above": {
        def: "At a higher place or level.",
        ex: [
          "The bird flies above the trees.",
          "The sun is above the clouds.",
          "The light is above the table.",
          "She looked above her head.",
          "The plane is above us.",
          "The cat jumped above the wall."
        ]
      },
      "moved": {
        def: "Changed place or position.",
        ex: [
          "She moved her chair.",
          "He moved to a new house.",
          "The cat moved away.",
          "We moved the table.",
          "They moved fast.",
          "I moved my book."
        ]
      },
      "past": {
        def: "By or beyond something.",
        ex: [
          "He walked past the store.",
          "She ran past the dog.",
          "The car drove past the house.",
          "We went past the tree.",
          "They looked past the fence.",
          "The bird flew past us."
        ]
      },
      "careful": {
        def: "Trying not to make a mistake or get hurt.",
        ex: [
          "Be careful with the glass.",
          "She is careful when she walks.",
          "He is careful with his toys.",
          "We are careful in the kitchen.",
          "They are careful not to fall.",
          "I am careful with my homework."
        ]
      },
      "not": {
        def: "Shows something is not true or does not happen.",
        ex: [
          "I am not sad.",
          "She is not here.",
          "He did not eat.",
          "We are not late.",
          "They are not ready.",
          "It is not cold."
        ]
      },
      "make": {
        def: "To build, create, or do something.",
        ex: [
          "I make a cake.",
          "She can make a drawing.",
          "He will make a toy.",
          "We make a plan.",
          "They make noise.",
          "Can you make a card?"
        ]
      },
      "sound": {
        def: "Something you hear.",
        ex: [
          "I hear a sound.",
          "The sound is loud.",
          "She made a sound.",
          "He likes the sound of music.",
          "We heard a funny sound.",
          "What is that sound?"
        ]
      },
      "tiptoed": {
        def: "Walked quietly on your toes.",
        ex: [
          "She tiptoed across the room.",
          "He tiptoed past the dog.",
          "The child tiptoed to the door.",
          "We tiptoed so we would not wake him.",
          "They tiptoed in the house.",
          "I tiptoed behind the chair."
        ]
      },
      "behind": {
        def: "At the back of something.",
        ex: [
          "The cat is behind the box.",
          "She hid behind the tree.",
          "He stands behind his friend.",
          "We sit behind the desk.",
          "They are behind the car.",
          "I am behind you."
        ]
      },
      "bush": {
        def: "A small plant with many branches and leaves.",
        ex: [
          "The bird is in the bush.",
          "She hid behind the bush.",
          "He planted a bush.",
          "The bush has green leaves.",
          "We saw a bug on the bush.",
          "The bush is tall."
        ]
      },
      "hiding": {
        def: "Staying where you cannot be seen.",
        ex: [
          "The cat is hiding under the bed.",
          "She is hiding behind the door.",
          "He is hiding from his friend.",
          "We are hiding in the closet.",
          "They are hiding in the garden.",
          "I am hiding behind the chair."
        ]
      },
      "gardener": {
        def: "A person who takes care of a garden.",
        ex: [
          "The gardener plants flowers.",
          "She is a gardener.",
          "The gardener waters the plants.",
          "He helps the gardener.",
          "The gardener picks carrots.",
          "We saw the gardener in the garden."
        ]
      },
      "bird": {
        def: "An animal with feathers and wings that can fly.",
        ex: [
          "The bird is singing.",
          "She saw a red bird.",
          "The bird flew away.",
          "He likes to watch birds.",
          "Birds build nests.",
          "The bird sat on a branch."
        ]
      },
      "sang": {
        def: "Made music with your voice.",
        ex: [
          "She sang a song.",
          "He sang in the car.",
          "The bird sang in the tree.",
          "They sang together.",
          "I sang at school.",
          "We sang a happy song."
        ]
      },
      "branch": {
        def: "A part of a tree that grows out from the trunk.",
        ex: [
          "The bird sat on the branch.",
          "She climbed the branch.",
          "He broke a branch.",
          "The branch has leaves.",
          "We saw a nest on the branch.",
          "The branch is long."
        ]
      },
      "filling": {
        def: "Making something full.",
        ex: [
          "She is filling the cup.",
          "He is filling the box.",
          "The rain is filling the bucket.",
          "We are filling the pool.",
          "They are filling bags with sand.",
          "I am filling the glass."
        ]
      },
      "air": {
        def: "The gas we breathe.",
        ex: [
          "We breathe air.",
          "The air is fresh.",
          "She feels the air.",
          "He opened the window for air.",
          "Birds fly in the air.",
          "The air is cool."
        ]
      },
      "with": {
        def: "Having or using something.",
        ex: [
          "I go with my friend.",
          "She eats with a spoon.",
          "He plays with the dog.",
          "We draw with crayons.",
          "They walk with their mom.",
          "Can you come with me?"
        ]
      },
      "sweet": {
        def: "Tasting like sugar or honey.",
        ex: [
          "Candy is sweet.",
          "She likes sweet apples.",
          "The juice is sweet.",
          "He ate a sweet cookie.",
          "The cake is sweet.",
          "The smell is sweet."
        ]
      },
      "music": {
        def: "Sounds made by singing or playing instruments.",
        ex: [
          "I like music.",
          "She listens to music.",
          "He plays music on the piano.",
          "We sing music at school.",
          "They dance to music.",
          "The music is loud."
        ]
      },
      "hurried": {
        def: "Moved quickly.",
        ex: [
          "She hurried to school.",
          "He hurried home.",
          "They hurried to the bus.",
          "I hurried to the store.",
          "We hurried to eat.",
          "The dog hurried to the door."
        ]
      },
      "through": {
        def: "From one side to the other.",
        ex: [
          "He walked through the door.",
          "She ran through the park.",
          "We drove through the tunnel.",
          "They looked through the window.",
          "The cat went through the hole.",
          "I read through the book."
        ]
      },
      "rows": {
        def: "Lines of things or people.",
        ex: [
          "The chairs are in rows.",
          "She planted rows of flowers.",
          "He saw rows of books.",
          "We sat in rows.",
          "There are rows of trees.",
          "The desks are in rows."
        ]
      },
      "dreaming": {
        def: "Thinking of something nice while asleep or awake.",
        ex: [
          "She is dreaming of summer.",
          "He is dreaming at night.",
          "They are dreaming of cake.",
          "I am dreaming of a trip.",
          "We are dreaming of fun.",
          "Are you dreaming now?"
        ]
      },
      "home": {
        def: "The place where you live.",
        ex: [
          "I go home after school.",
          "She is at home.",
          "He plays at home.",
          "We eat dinner at home.",
          "They are happy at home.",
          "Home is where my family is."
        ]
      },
      "and": {
        def: "Used to join words or groups of words.",
        ex: [
          "I have a cat and a dog.",
          "She likes apples and oranges.",
          "He ran and jumped.",
          "We sing and dance.",
          "They play and laugh.",
          "Can you read and write?"
        ]
      },
      "safety": {
        def: "Being safe from harm or danger.",
        ex: [
          "Wear a helmet for safety.",
          "Safety is important.",
          "She cares about safety.",
          "He checks for safety.",
          "We talk about safety at school.",
          "Safety comes first."
        ]
      }
    };

    // Find the story sentence containing a word (for prepositions)
    function getSentenceWithWord(word, storyText) {
      // Find the sentence containing the word as a whole word (case-insensitive)
      const sentences = storyText.match(/[^\.!\?]+[\.!\?]+/g) || [storyText];
      for (let s of sentences) {
        // Use regex to match the word as a whole word (case-insensitive)
        let re = new RegExp("\\b" + word + "\\b", "i");
        if (re.test(s)) return s.trim();
      }
      return "";
    }

    // Underline only the clicked preposition in the sentence
    function underlinePrepositionInSentence(sentence, prep) {
      // Only underline the first occurrence of the preposition as a whole word
      const re = new RegExp("\\b(" + prep + ")\\b", "i");
      return sentence.replace(re, '<span style="text-decoration:underline;">$1</span>');
    }

    // Remove any existing popup
    function removePopup() {
      const popup = document.querySelector('.popup');
      if (popup) popup.parentNode.removeChild(popup);
      document.querySelectorAll('.uword.selected').forEach(el=>el.classList.remove('selected'));
    }

    // Position the popup below the clicked word, inside #story
    function positionPopup(popup, wordElem, storyElem, offsetY=0) {
      // Get bounding rects
      const wordRect = wordElem.getBoundingClientRect();
      const storyRect = storyElem.getBoundingClientRect();
      // Calculate top: below the bottom of the word, relative to #story
      let top = wordRect.bottom - storyRect.top + 4 + offsetY;
      // Calculate left: horizontally centered in #story
      let popupWidth = storyRect.width - 32; // 2em = ~32px
      if (popupWidth < 220) popupWidth = storyRect.width * 0.98; // never too narrow
      popup.style.width = popupWidth + "px";
      let left = (storyRect.width - popupWidth) / 2;
      popup.style.left = left + "px";
      popup.style.top = top + "px";
      // Ensure popup stays inside #story vertically
      let popupRect = popup.getBoundingClientRect();
      let bottomOverflow = (popupRect.bottom - storyRect.bottom);
      if (bottomOverflow > 0) {
        // Move popup up so it fits
        top = top - bottomOverflow - 12;
        if (top < 0) top = 4;
        popup.style.top = top + "px";
      }
    }

    // Show popup for preposition: choose definition
    function showPrepositionPopup(wordElem, prep, storyText) {
      removePopup();
      wordElem.classList.add('selected');
      const storyElem = document.getElementById('story');
      let popup = document.createElement('div');
      popup.className = 'popup';
      // Get sentence containing preposition
      let sentence = getSentenceWithWord(prep, storyText);
      let underlinedSentence = underlinePrepositionInSentence(sentence, prep);
      // Show word at top
      let wordDiv = document.createElement('div');
      wordDiv.className = 'popup-word';
      wordDiv.innerHTML = prep;
      popup.appendChild(wordDiv);
      // Show sentence with preposition underlined
      let sentDiv = document.createElement('div');
      sentDiv.className = 'popup-sentence';
      sentDiv.innerHTML = underlinedSentence;
      popup.appendChild(sentDiv);
      // Prompt
      let promptDiv = document.createElement('div');
      promptDiv.className = 'popup-prompt';
      promptDiv.innerText = "Pick the best meaning below.";
      popup.appendChild(promptDiv);
      // Definitions list
      let defs = JASON_PREPOSITIONS[prep];
      if (!defs) {
        // Not found, show single definition
        defs = [{
          def: "A word that shows place, time, or how things are related.",
          examples: [
            `The cat is ${prep} the box.`,
            `We walk ${prep} school.`,
            `She sits ${prep} the chair.`,
            `He jumps ${prep} the wall.`,
            `Put your book ${prep} the table.`,
            `The dog is ${prep} the yard.`
          ]
        }];
      }
      let defsList = document.createElement('div');
      defsList.className = 'popup-definitions-list';
      defs.forEach((d, idx) => {
        let defDiv = document.createElement('div');
        defDiv.className = 'popup-def-item';
        defDiv.innerText = d.def;
        defDiv.onclick = (e) => {
          e.stopPropagation();
          showPrepositionExamplesPopup(wordElem, prep, d, popup, storyElem);
        };
        defsList.appendChild(defDiv);
      });
      popup.appendChild(defsList);
      // Close button
      let closeBtn = document.createElement('button');
      closeBtn.className = 'close-btn';
      closeBtn.innerText = 'X';
      closeBtn.onclick = removePopup;
      popup.appendChild(closeBtn);
      storyElem.appendChild(popup);
      positionPopup(popup, wordElem, storyElem);
    }

    // Show popup for preposition example sentences (after picking meaning)
    function showPrepositionExamplesPopup(wordElem, prep, defObj, parentPopup, storyElem) {
      // Remove any existing example popups
      let oldEx = document.getElementById('popup-examples-popup');
      if (oldEx) oldEx.parentNode.removeChild(oldEx);
      let popup = document.createElement('div');
      popup.className = 'popup';
      popup.id = 'popup-examples-popup';
      // Word at top
      let wordDiv = document.createElement('div');
      wordDiv.className = 'popup-word';
      wordDiv.innerHTML = prep;
      popup.appendChild(wordDiv);
      // Definition
      let defDiv = document.createElement('div');
      defDiv.className = 'popup-definition';
      defDiv.innerText = defObj.def;
      popup.appendChild(defDiv);
      // Example sentences with preposition underlined
      let exDiv = document.createElement('div');
      exDiv.className = 'popup-examples';
      defObj.examples.slice(0,6).forEach(ex => {
        let re = new RegExp("\\b(" + prep + ")\\b", "i");
        let exHTML = ex.replace(re, '<span style="text-decoration:underline;">$1</span>');
        let exItem = document.createElement('div');
        exItem.className = 'example';
        exItem.innerHTML = exHTML;
        exDiv.appendChild(exItem);
      });
      popup.appendChild(exDiv);
      // Close button
      let closeBtn = document.createElement('button');
      closeBtn.className = 'close-btn';
      closeBtn.innerText = 'X';
      closeBtn.onclick = removePopup;
      popup.appendChild(closeBtn);
      storyElem.appendChild(popup);
      // Position below the clicked definition (parentPopup)
      let defElems = parentPopup.querySelectorAll('.popup-def-item');
      let idx = Array.from(defElems).findIndex(el => el.innerText === defObj.def);
      let defElem = defElems[idx];
      if (defElem) {
        positionPopup(popup, defElem, storyElem, 8);
      } else {
        positionPopup(popup, wordElem, storyElem, 8);
      }
    }

    // Show popup for non-prepositions
    function showSimplePopup(wordElem, word, dict) {
      removePopup();
      wordElem.classList.add('selected');
      const storyElem = document.getElementById('story');
      let popup = document.createElement('div');
      popup.className = 'popup';
      // Word at top
      let wordDiv = document.createElement('div');
      wordDiv.className = 'popup-word';
      wordDiv.innerText = word;
      popup.appendChild(wordDiv);
      // Definition
      let defDiv = document.createElement('div');
      defDiv.className = 'popup-definition';
      defDiv.innerText = dict.def;
      popup.appendChild(defDiv);
      // Example sentences
      let exDiv = document.createElement('div');
      exDiv.className = 'popup-examples';
      dict.ex.slice(0,6).forEach(ex => {
        let exItem = document.createElement('div');
        exItem.className = 'example';
        exItem.innerText = ex;
        exDiv.appendChild(exItem);
      });
      popup.appendChild(exDiv);
      // Close button
      let closeBtn = document.createElement('button');
      closeBtn.className = 'close-btn';
      closeBtn.innerText = 'X';
      closeBtn.onclick = removePopup;
      popup.appendChild(closeBtn);
      storyElem.appendChild(popup);
      positionPopup(popup, wordElem, storyElem);
    }

    // Main event handler
    document.getElementById('story').addEventListener('click', function(e) {
      let wordElem = e.target.closest('.uword');
      if (!wordElem) return;
      let word = wordElem.getAttribute('data-word');
      let prep = wordElem.getAttribute('data-prep');
      let storyText = document.getElementById('story').innerText;
      if (prep && JASON_PREPOSITIONS.hasOwnProperty(prep)) {
        showPrepositionPopup(wordElem, prep, storyText);
      } else if (prep) {
        // Preposition not in Jason, show generic
        showPrepositionPopup(wordElem, prep, storyText);
      } else if (SIMPLE_DICTIONARY[word]) {
        showSimplePopup(wordElem, word, SIMPLE_DICTIONARY[word]);
      } else {
        // Fallback: unknown word
        showSimplePopup(wordElem, word, {
          def: "A word from the story.",
          ex: [
            `This is the word "${word}".`,
            `It is in the story.`,
            `Try to read "${word}".`,
            `Can you say "${word}"?`,
            `"${word}" is a word.`,
            `Look for "${word}" in the story.`
          ]
        });
      }
    });

    // Remove popup on click outside
    document.body.addEventListener('click', function(e) {
      if (!e.target.closest('.popup') && !e.target.closest('.uword')) {
        removePopup();
      }
    });

    // Remove popup on resize (to prevent misplacement)
    window.addEventListener('resize', removePopup);
  </script>
</body>
</html>
