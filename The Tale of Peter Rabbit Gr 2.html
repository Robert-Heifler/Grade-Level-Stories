<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>The Tale of Peter Rabbit - Grade Two</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #f6f7fb;
      font-family: 'Arial Rounded MT Bold', Arial, sans-serif;
    }
    #story {
      max-width: 900px;
      margin: 0 auto;
      padding: 2em 1em 6em 1em;
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.08);
      position: relative;
      min-height: 80vh;
    }
    .story-text {
      font-size: 2.1em;
      font-weight: bold;
      line-height: 1.45;
      letter-spacing: 0.01em;
      color: #222;
      width: 100%;
      word-break: break-word;
      user-select: none;
    }
    .uword {
      text-decoration: underline;
      cursor: pointer;
      text-underline-offset: 0.18em;
      text-decoration-thickness: 0.13em;
      transition: background 0.2s;
      border-radius: 0.18em;
      padding: 0 0.07em;
    }
    .uword.selected {
      background: #cbeafe;
      color: #1a3b5d;
    }
    .popup {
      position: absolute;
      background: #f3faff;
      border-radius: 1.1em;
      box-shadow: 0 4px 18px rgba(0,0,0,0.13);
      padding: 1.5em 1em 1.5em 1em;
      min-width: 200px;
      z-index: 99;
      font-size: 2em;
      font-weight: bold;
      color: #1a3b5d;
      display: flex;
      flex-direction: column;
      align-items: center;
      max-width: none;
      width: calc(100% - 2em);
      left: 1em;
      box-sizing: border-box;
      border: 3px solid #b0e0ff;
      animation: popupIn 0.13s;
    }
    @keyframes popupIn {
      0% { opacity: 0; transform: translateY(20px);}
      100% { opacity: 1; transform: translateY(0);}
    }
    .popup .close-btn {
      position: absolute;
      top: 0.6em;
      right: 1.1em;
      font-size: 1.2em;
      color: #2a587a;
      background: none;
      border: none;
      font-weight: bold;
      cursor: pointer;
      z-index: 2;
      padding: 0.1em 0.5em;
      border-radius: 0.3em;
      transition: background 0.18s;
    }
    .popup .close-btn:hover {
      background: #e3f3fa;
    }
    .popup .popup-word {
      font-size: 1.2em;
      font-weight: bold;
      width: 100%;
      text-align: center;
      margin-bottom: 0.2em;
      margin-top: 0.1em;
      color: #0a2d4d;
      letter-spacing: 0.01em;
    }
    .popup .popup-def {
      font-size: 1.04em;
      font-weight: bold;
      margin: 0.4em 0 0.7em 0;
      width: 100%;
      text-align: center;
      color: #1a3b5d;
    }
    .popup .popup-examples {
      width: 100%;
      margin-top: 0.8em;
      display: flex;
      flex-direction: column;
      gap: 0.23em;
    }
    .popup .popup-examples span {
      font-size: 0.93em;
      font-weight: bold;
      color: #295c7c;
      width: 100%;
      display: block;
      text-align: left;
      background: none;
      border-radius: 0.2em;
      padding: 0.03em 0.07em;
    }
    .popup .popup-defs-list {
      width: 100%;
      max-height: 7em;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 0.33em;
      margin-top: 0.7em;
      margin-bottom: 0.7em;
    }
    .popup .popup-def-choice {
      width: 100%;
      background: #e8f6ff;
      border-radius: 0.5em;
      padding: 0.25em 0.2em;
      text-align: center;
      font-size: 0.95em;
      font-weight: bold;
      color: #1a3b5d;
      margin-bottom: 0.1em;
      cursor: pointer;
      border: 2px solid #b0e0ff;
      transition: background 0.15s, border 0.15s;
      outline: none;
    }
    .popup .popup-def-choice:hover {
      background: #d0eaff;
      border: 2px solid #7ed0ff;
    }
    .popup .popup-sentence {
      width: 100%;
      font-size: 0.93em;
      font-weight: bold;
      color: #1a3b5d;
      text-align: center;
      margin: 0.5em 0 0.7em 0;
      line-height: 1.3;
    }
    .popup .popup-prompt {
      width: 100%;
      font-size: 0.97em;
      font-weight: bold;
      color: #2a587a;
      text-align: center;
      margin-bottom: 0.3em;
      margin-top: 0.1em;
    }
    .popup .popup-def-choice.selected {
      background: #cbeafe;
      border: 2px solid #7ed0ff;
      color: #0a2d4d;
    }
    @media (max-width: 600px) {
      #story {
        padding: 1em 0.2em 6em 0.2em;
      }
      .popup {
        font-size: 1.4em;
        padding: 1em 0.2em 1em 0.2em;
      }
      .story-text {
        font-size: 1.3em;
      }
    }
  </style>
</head>
<body>
  <div id="story">
    <div class="story-text" id="story-text">
      <span class="uword" data-word="Peter">Peter</span> <span class="uword" data-word="hopped">hopped</span> <span class="uword" data-word="in" data-prep="in">in</span> <span class="uword" data-word="the">the</span> <span class="uword" data-word="garden">garden</span>, <span class="uword" data-word="looking">looking</span> <span class="uword" data-word="for">for</span> <span class="uword" data-word="something">something</span> <span class="uword" data-word="to" data-prep="to">to</span> <span class="uword" data-word="eat">eat</span>. <span class="uword" data-word="He">He</span> <span class="uword" data-word="squeezed">squeezed</span> <span class="uword" data-word="under">under</span> <span class="uword" data-word="the">the</span> <span class="uword" data-word="gate">gate</span>, <span class="uword" data-word="hoping">hoping</span> <span class="uword" data-word="to" data-prep="to">to</span> <span class="uword" data-word="find">find</span> <span class="uword" data-word="a">a</span> <span class="uword" data-word="snack">snack</span>. <span class="uword" data-word="A">A</span> <span class="uword" data-word="row">row</span> <span class="uword" data-word="of" data-prep="of">of</span> <span class="uword" data-word="carrots">carrots</span> <span class="uword" data-word="grew">grew</span> <span class="uword" data-word="in" data-prep="in">in</span> <span class="uword" data-word="the">the</span> <span class="uword" data-word="soft">soft</span> <span class="uword" data-word="dirt">dirt</span>, <span class="uword" data-word="bright">bright</span> <span class="uword" data-word="in" data-prep="in">in</span> <span class="uword" data-word="the">the</span> <span class="uword" data-word="morning">morning</span> <span class="uword" data-word="sun">sun</span>. <span class="uword" data-word="Peter">Peter</span> <span class="uword" data-word="nibbled">nibbled</span> <span class="uword" data-word="on" data-prep="on">on</span> <span class="uword" data-word="a">a</span> <span class="uword" data-word="leaf">leaf</span>, <span class="uword" data-word="feeling">feeling</span> <span class="uword" data-word="happy">happy</span> <span class="uword" data-word="in" data-prep="in">in</span> <span class="uword" data-word="the">the</span> <span class="uword" data-word="cool">cool</span> <span class="uword" data-word="shade">shade</span>. <span class="uword" data-word="He">He</span> <span class="uword" data-word="saw">saw</span> <span class="uword" data-word="a">a</span> <span class="uword" data-word="big">big</span> <span class="uword" data-word="cat">cat</span> <span class="uword" data-word="sitting">sitting</span> <span class="uword" data-word="on" data-prep="on">on</span> <span class="uword" data-word="a">a</span> <span class="uword" data-word="wall">wall</span>, <span class="uword" data-word="watching">watching</span> <span class="uword" data-word="him">him</span> <span class="uword" data-word="from">from</span> <span class="uword" data-word="above">above</span>. <span class="uword" data-word="Peter">Peter</span> <span class="uword" data-word="moved">moved</span> <span class="uword" data-word="past">past</span> <span class="uword" data-word="the">the</span> <span class="uword" data-word="cat">cat</span>, <span class="uword" data-word="careful">careful</span> <span class="uword" data-word="not">not</span> <span class="uword" data-word="to" data-prep="to">to</span> <span class="uword" data-word="make">make</span> <span class="uword" data-word="a">a</span> <span class="uword" data-word="sound">sound</span>. <span class="uword" data-word="He">He</span> <span class="uword" data-word="tiptoed">tiptoed</span> <span class="uword" data-word="behind">behind</span> <span class="uword" data-word="a">a</span> <span class="uword" data-word="bush">bush</span>, <span class="uword" data-word="hiding">hiding</span> <span class="uword" data-word="from">from</span> <span class="uword" data-word="the">the</span> <span class="uword" data-word="gardener">gardener</span>. <span class="uword" data-word="A">A</span> <span class="uword" data-word="bird">bird</span> <span class="uword" data-word="sang">sang</span> <span class="uword" data-word="on" data-prep="on">on</span> <span class="uword" data-word="a">a</span> <span class="uword" data-word="branch">branch</span>, <span class="uword" data-word="filling">filling</span> <span class="uword" data-word="the">the</span> <span class="uword" data-word="air">air</span> <span class="uword" data-word="with">with</span> <span class="uword" data-word="sweet">sweet</span> <span class="uword" data-word="music">music</span>. <span class="uword" data-word="Peter">Peter</span> <span class="uword" data-word="hurried">hurried</span> <span class="uword" data-word="through">through</span> <span class="uword" data-word="the">the</span> <span class="uword" data-word="rows">rows</span>, <span class="uword" data-word="dreaming">dreaming</span> <span class="uword" data-word="of" data-prep="of">of</span> <span class="uword" data-word="home">home</span> <span class="uword" data-word="and">and</span> <span class="uword" data-word="safety">safety</span>.
    </div>
  </div>
  <script>
    // Jason-style dictionary for prepositions
    const jasonPreps = {
      "to": [
        {def: "the direction of", ex: [
          "We go to school every day.",
          "She walks to the store.",
          "Give the toy to your friend.",
          "The dog ran to the door.",
          "He pointed to the sky.",
          "Mom drove to work."
        ]},
        {def: "as far", ex: [
          "Walk to the end of the street.",
          "Run to the big tree.",
          "She read to page ten.",
          "Draw a line to the corner.",
          "We played to the last minute.",
          "He jumped to the top step."
        ]},
        {def: "until or up to a time", ex: [
          "Wait to the bell rings.",
          "Stay here to five o'clock.",
          "She worked to lunchtime.",
          "I will sleep to morning.",
          "Read to the end of the story.",
          "We can play to dinner."
        ]},
        {def: "touching or leaning against something", ex: [
          "The bike is leaning to the wall.",
          "She pressed her ear to the door.",
          "Put your hand to your heart.",
          "He glued the paper to the board.",
          "The puppy snuggled to my leg.",
          "The sign was nailed to the tree."
        ]},
        {def: "for the purpose of", ex: [
          "She went to the store to buy milk.",
          "He called to ask a question.",
          "We study to learn.",
          "They ran to catch the bus.",
          "I came to help you.",
          "She smiled to show she was happy."
        ]},
        {def: "related to or causing something", ex: [
          "The noise led to a complaint.",
          "His hard work led to success.",
          "Rain can lead to flooding.",
          "A cold can lead to a cough.",
          "The story led to laughter.",
          "The mistake led to a new idea."
        ]},
        {def: "alongside or belonging with something", ex: [
          "The answer is next to the question.",
          "The picture belongs to the book.",
          "The key is to the lock.",
          "The shoes are to the outfit.",
          "The lid is to the jar.",
          "The leash is to the dog."
        ]},
        {def: "showing how two things are similar or different", ex: [
          "Ice is cold compared to fire.",
          "My bag is bigger to yours.",
          "This book is easy to that one.",
          "The red car is fast to the blue one.",
          "Math is hard to some kids.",
          "Summer is hot to winter."
        ]},
        {def: "in agreement with", ex: [
          "She is true to her word.",
          "He acted to the rules.",
          "The answer is right to the teacher.",
          "I will be kind to my friends.",
          "We listened to the leader.",
          "She played to the plan."
        ]},
        {def: "in or for each", ex: [
          "There are five apples to each basket.",
          "Two students to a desk.",
          "One cookie to every child.",
          "Ten points to a game.",
          "Four wheels to a car.",
          "Three books to a shelf."
        ]},
        {def: "showing who is receiving something", ex: [
          "Give the letter to Sam.",
          "She handed the toy to her brother.",
          "Pass the salt to me.",
          "Send the gift to your friend.",
          "The teacher gave homework to the class.",
          "I told the story to my mom."
        ]}
      ],
      "of": [
        {def: "coming from", ex: [
          "The smell of cookies is nice.",
          "A cup of water is on the table.",
          "The sound of music filled the room.",
          "A piece of cake for you.",
          "A group of kids played outside.",
          "A bag of apples is heavy."
        ]},
        {def: "resulting from", ex: [
          "The joy of winning is great.",
          "The pain of falling hurt.",
          "The fun of playing is the best.",
          "The noise of cars is loud.",
          "The mess of painting is big.",
          "The taste of candy is sweet."
        ]},
        {def: "at a distance from", ex: [
          "The school is east of my house.",
          "The park is north of the library.",
          "The cat is far of the door.",
          "The tree is left of the bench.",
          "The ball is right of the chair.",
          "The store is south of the station."
        ]},
        {def: "by", ex: [
          "A book of poems by Maya.",
          "A painting of the artist.",
          "A song of the singer.",
          "A letter of my friend.",
          "A story of the writer.",
          "A drawing of the child."
        ]},
        {def: "separated from", ex: [
          "A piece of the puzzle is missing.",
          "A part of the cake was eaten.",
          "A slice of bread is on the plate.",
          "A bit of the toy broke.",
          "A drop of water fell.",
          "A chunk of ice melted."
        ]},
        {def: "taken out of a group or a whole number", ex: [
          "Three of the five dogs barked.",
          "Half of the class left early.",
          "Most of the apples are red.",
          "Some of the kids are tall.",
          "Many of the books are new.",
          "One of the cars is blue."
        ]},
        {def: "made from", ex: [
          "A shirt of cotton feels soft.",
          "A table of wood is strong.",
          "A ring of gold is shiny.",
          "A cup of glass is clear.",
          "A hat of straw is light.",
          "A blanket of wool is warm."
        ]},
        {def: "belonging to", ex: [
          "The toys of the children are everywhere.",
          "The books of the library are old.",
          "The keys of the car are lost.",
          "The name of the school is long.",
          "The songs of the birds are pretty.",
          "The color of the sky is blue."
        ]},
        {def: "having or owning", ex: [
          "A girl of many talents.",
          "A man of great strength.",
          "A dog of quick speed.",
          "A team of good players.",
          "A house of many rooms.",
          "A boy of kind heart."
        ]},
        {def: "including", ex: [
          "The bag of candy has gum, too.",
          "The box of toys has cars and dolls.",
          "The list of chores has sweeping.",
          "The set of crayons has red and blue.",
          "The class of students has boys and girls.",
          "The team of players has new members."
        ]},
        {def: "that is", ex: [
          "The city of Paris is in France.",
          "The month of June is hot.",
          "The animal of the year is the tiger.",
          "The color of the day is yellow.",
          "The book of the week is fun.",
          "The food of the day is pizza."
        ]},
        {def: "about or concerning", ex: [
          "The story of the hero is exciting.",
          "The talk of the weather was long.",
          "The lesson of math is hard.",
          "The news of the day is sad.",
          "The question of the test is tricky.",
          "The problem of the puzzle is tough."
        ]},
        {def: "during", ex: [
          "The fun of summer is swimming.",
          "The joy of holidays is gifts.",
          "The work of the day is done.",
          "The games of recess are fun.",
          "The study of night is quiet.",
          "The sleep of winter is deep."
        ]},
        {def: "before a certain time", ex: [
          "The end of the week is Friday.",
          "The start of the day is morning.",
          "The close of school is June.",
          "The finish of the race is near.",
          "The last of the month is coming.",
          "The close of class is soon."
        ]}
      ],
      "in": [
        {def: "inside or surrounded by something", ex: [
          "The cat is in the box.",
          "Put the book in your bag.",
          "There is milk in the cup.",
          "The ball is in the basket.",
          "He is in the room.",
          "The dog sleeps in the bed."
        ]},
        {def: "during or after", ex: [
          "In the morning, we eat breakfast.",
          "We play in the afternoon.",
          "The stars come out in the night.",
          "She reads in the evening.",
          "We swim in the summer.",
          "It snows in the winter."
        ]},
        {def: "not beyond or not past", ex: [
          "Finish your work in ten minutes.",
          "Come back in an hour.",
          "We will leave in five days.",
          "The movie starts in a minute.",
          "I will be home in a while.",
          "He will call in a moment."
        ]},
        {def: "part of a group or category", ex: [
          "She is in the soccer team.",
          "He is in the choir.",
          "I am in the third grade.",
          "We are in the same class.",
          "The book is in the library.",
          "The painting is in the museum."
        ]},
        {def: "using something as a tool or method", ex: [
          "Write your answer in pencil.",
          "Say it in a loud voice.",
          "Draw in color.",
          "Explain in simple words.",
          "Sing in English.",
          "Count in twos."
        ]},
        {def: "because of", ex: [
          "He was late in traffic.",
          "She cried in pain.",
          "The team won in excitement.",
          "He laughed in surprise.",
          "She smiled in joy.",
          "They cheered in happiness."
        ]},
        {def: "moving inside something", ex: [
          "The fish swam in the water.",
          "The car drove in the tunnel.",
          "The bird flew in the sky.",
          "The kids ran in the gym.",
          "The train moves in the city.",
          "The dog ran in the field."
        ]}
      ],
      "on": [
        {def: "resting or attached to something", ex: [
          "The book is on the table.",
          "Put your shoes on the floor.",
          "The cat sits on the chair.",
          "The hat is on my head.",
          "The picture is on the wall.",
          "The cup is on the desk."
        ]},
        {def: "on the surface of", ex: [
          "The leaf is on the water.",
          "The bug is on the window.",
          "The snow is on the roof.",
          "The paint is on the paper.",
          "The crumbs are on the plate.",
          "The sticker is on the box."
        ]},
        {def: "next to or beside something", ex: [
          "Sit on my right.",
          "The dog is on my left.",
          "The lamp is on the side of the bed.",
          "The pen is on the edge of the desk.",
          "The shoes are on the side of the door.",
          "The bag is on the side of the chair."
        ]},
        {def: "at the time something happens", ex: [
          "On Monday, we have art class.",
          "The party is on my birthday.",
          "We go to the park on weekends.",
          "On holidays, we visit family.",
          "On rainy days, we stay inside.",
          "On the first day of school, we meet our teacher."
        ]},
        {def: "related to something", ex: [
          "She gave a talk on science.",
          "The book is on animals.",
          "We worked on a project.",
          "He wrote a story on friendship.",
          "The lesson is on math.",
          "They watched a movie on space."
        ]},
        {def: "because of", ex: [
          "He was late on account of traffic.",
          "She stayed home on doctor's orders.",
          "The game was canceled on account of rain.",
          "He smiled on hearing the news.",
          "She cried on seeing the puppy.",
          "We left on time."
        ]}
      ]
    };

    // Definitions for all other underlined words/idioms/contractions
    const wordDefs = {
      "Peter": {
        def: "A boy rabbit who is the main character of the story.",
        ex: [
          "Peter is a brave rabbit.",
          "Peter likes to explore.",
          "Peter wears a blue jacket.",
          "Peter is very curious.",
          "Peter runs fast.",
          "Peter loves his family."
        ]
      },
      "hopped": {
        def: "Jumped forward with both feet together.",
        ex: [
          "The frog hopped away.",
          "The bunny hopped in the grass.",
          "She hopped over the puddle.",
          "The bird hopped on the branch.",
          "He hopped up the steps.",
          "The kangaroo hopped fast."
        ]
      },
      "the": {
        def: "Used to talk about a person or thing already known.",
        ex: [
          "The dog barked.",
          "She found the book.",
          "The sun is bright.",
          "The car is red.",
          "The apple is sweet.",
          "The teacher smiled."
        ]
      },
      "garden": {
        def: "A place where plants, flowers, or vegetables grow.",
        ex: [
          "The garden has many flowers.",
          "We picked carrots in the garden.",
          "The garden is behind the house.",
          "A bird sang in the garden.",
          "The garden is full of color.",
          "She waters the garden."
        ]
      },
      "looking": {
        def: "Trying to find something with your eyes.",
        ex: [
          "He is looking for his shoes.",
          "She is looking at the stars.",
          "The cat is looking under the bed.",
          "I am looking for my friend.",
          "They are looking for the dog.",
          "We are looking at the picture."
        ]
      },
      "for": {
        def: "Trying to get or find something.",
        ex: [
          "I am looking for my hat.",
          "She is waiting for the bus.",
          "He asked for help.",
          "They search for treasure.",
          "We hope for sunshine.",
          "The dog runs for the ball."
        ]
      },
      "something": {
        def: "An unknown or unnamed thing.",
        ex: [
          "I hear something outside.",
          "She wants to show me something.",
          "He found something in the box.",
          "There is something on the table.",
          "They need something to eat.",
          "We saw something funny."
        ]
      },
      "eat": {
        def: "To put food in your mouth and swallow it.",
        ex: [
          "I eat breakfast every day.",
          "She likes to eat apples.",
          "The dog will eat his food.",
          "We eat lunch at noon.",
          "He wants to eat cake.",
          "They eat dinner together."
        ]
      },
      "He": {
        def: "A word used to talk about a boy or man.",
        ex: [
          "He is my brother.",
          "He runs fast.",
          "He likes to read.",
          "He is very kind.",
          "He plays soccer.",
          "He is at school."
        ]
      },
      "squeezed": {
        def: "Moved through a small space by pressing your body.",
        ex: [
          "He squeezed through the fence.",
          "The mouse squeezed into the hole.",
          "She squeezed past the chair.",
          "The cat squeezed under the door.",
          "He squeezed into his seat.",
          "The puppy squeezed behind the couch."
        ]
      },
      "under": {
        def: "Below or lower than something.",
        ex: [
          "The cat is under the table.",
          "He hid under the bed.",
          "The dog sleeps under the blanket.",
          "The ball rolled under the couch.",
          "She found her shoe under the chair.",
          "The bug is under the leaf."
        ]
      },
      "gate": {
        def: "A door in a fence or wall that you can open and close.",
        ex: [
          "Open the gate to the garden.",
          "The dog ran through the gate.",
          "She closed the gate behind her.",
          "The gate is made of wood.",
          "He peeked over the gate.",
          "The gate swings open."
        ]
      },
      "hoping": {
        def: "Wanting something good to happen.",
        ex: [
          "I am hoping for a sunny day.",
          "She is hoping to win the game.",
          "He is hoping for a treat.",
          "We are hoping to see our friends.",
          "They are hoping for a surprise.",
          "The boy is hoping for a new toy."
        ]
      },
      "find": {
        def: "To see or get something you are looking for.",
        ex: [
          "Can you find your shoes?",
          "I want to find my pencil.",
          "She will find her way home.",
          "He tries to find his dog.",
          "We need to find the answer.",
          "They find a secret path."
        ]
      },
      "a": {
        def: "Used before a word to mean one of something.",
        ex: [
          "I saw a cat.",
          "She has a book.",
          "He ate a cookie.",
          "We saw a bird.",
          "There is a dog in the yard.",
          "He found a coin."
        ]
      },
      "snack": {
        def: "A small amount of food you eat between meals.",
        ex: [
          "I ate a snack after school.",
          "She brought a snack to share.",
          "He likes a fruit snack.",
          "We had a snack before dinner.",
          "The snack is in my bag.",
          "They ate a snack at the park."
        ]
      },
      "A": {
        def: "Used before a word to mean one of something.",
        ex: [
          "A dog barked.",
          "A bird sang.",
          "A cat ran.",
          "A tree grew.",
          "A child laughed.",
          "A car drove by."
        ]
      },
      "row": {
        def: "A line of things or people placed side by side.",
        ex: [
          "The chairs are in a row.",
          "She planted a row of flowers.",
          "We sat in the front row.",
          "The books are in a row.",
          "The kids lined up in a row.",
          "The trees stand in a row."
        ]
      },
      "carrots": {
        def: "Orange vegetables that grow in the ground.",
        ex: [
          "Rabbits like to eat carrots.",
          "She picked carrots from the garden.",
          "Carrots are good for your eyes.",
          "We washed the carrots.",
          "He cut up the carrots.",
          "The carrots are orange."
        ]
      },
      "grew": {
        def: "Became bigger or developed over time.",
        ex: [
          "The plant grew tall.",
          "He grew three inches.",
          "The puppy grew fast.",
          "The tree grew new leaves.",
          "The flowers grew in spring.",
          "She grew a tomato plant."
        ]
      },
      "soft": {
        def: "Easy to press or not hard.",
        ex: [
          "The pillow is soft.",
          "The kitten's fur is soft.",
          "She likes soft bread.",
          "The blanket feels soft.",
          "The grass is soft.",
          "The toy is soft."
        ]
      },
      "dirt": {
        def: "Loose earth on the ground.",
        ex: [
          "The dog dug in the dirt.",
          "She planted seeds in the dirt.",
          "My shoes are dirty from the dirt.",
          "The worm lives in the dirt.",
          "The dirt is brown.",
          "He made a dirt pile."
        ]
      },
      "bright": {
        def: "Giving a lot of light or color.",
        ex: [
          "The sun is bright.",
          "Her shirt is bright red.",
          "The room is bright.",
          "The light is very bright.",
          "The flowers are bright yellow.",
          "The sky is bright today."
        ]
      },
      "morning": {
        def: "The early part of the day, before noon.",
        ex: [
          "I wake up in the morning.",
          "We eat breakfast in the morning.",
          "The sun rises in the morning.",
          "It is cool in the morning.",
          "She goes to school in the morning.",
          "Birds sing in the morning."
        ]
      },
      "sun": {
        def: "The big, bright star that gives us light and warmth.",
        ex: [
          "The sun shines in the sky.",
          "We play outside in the sun.",
          "The sun is hot.",
          "The sun rises every day.",
          "The sun sets at night.",
          "Plants need sun to grow."
        ]
      },
      "nibbled": {
        def: "Ate something by taking small bites.",
        ex: [
          "The mouse nibbled cheese.",
          "She nibbled on a cookie.",
          "The rabbit nibbled a carrot.",
          "He nibbled his sandwich.",
          "The bird nibbled seeds.",
          "The bug nibbled the leaf."
        ]
      },
      "leaf": {
        def: "A flat, green part of a plant or tree.",
        ex: [
          "The leaf is green.",
          "A leaf fell from the tree.",
          "She picked up a leaf.",
          "The bug sits on the leaf.",
          "The wind moved the leaf.",
          "He drew a big leaf."
        ]
      },
      "feeling": {
        def: "Knowing or showing how you feel inside.",
        ex: [
          "I am feeling happy.",
          "She is feeling sad.",
          "He is feeling tired.",
          "We are feeling excited.",
          "They are feeling cold.",
          "The dog is feeling playful."
        ]
      },
      "happy": {
        def: "Glad or joyful.",
        ex: [
          "She is happy today.",
          "He feels happy with his toy.",
          "They are happy to play.",
          "I am happy to see you.",
          "The dog looks happy.",
          "We are happy at the park."
        ]
      },
      "cool": {
        def: "A little cold, but not too cold.",
        ex: [
          "The water is cool.",
          "It is cool outside.",
          "The shade is cool.",
          "She wears a jacket when it's cool.",
          "The drink is cool.",
          "The wind feels cool."
        ]
      },
      "shade": {
        def: "A place where the sun does not shine.",
        ex: [
          "We sat in the shade.",
          "The tree gives shade.",
          "The dog rests in the shade.",
          "It is cooler in the shade.",
          "She found shade under the umbrella.",
          "The bench is in the shade."
        ]
      },
      "saw": {
        def: "Looked at or noticed something with your eyes.",
        ex: [
          "I saw a bird.",
          "She saw her friend.",
          "He saw the rainbow.",
          "We saw a movie.",
          "They saw a dog run.",
          "The boy saw the car."
        ]
      },
      "big": {
        def: "Large in size.",
        ex: [
          "The dog is big.",
          "She has a big smile.",
          "The box is big.",
          "He drew a big circle.",
          "The tree is big.",
          "We saw a big truck."
        ]
      },
      "cat": {
        def: "A small animal with fur that says 'meow.'",
        ex: [
          "The cat is sleeping.",
          "She has a black cat.",
          "The cat chased the mouse.",
          "He pets the cat.",
          "The cat jumped up.",
          "The cat likes milk."
        ]
      },
      "sitting": {
        def: "Resting with your bottom on something.",
        ex: [
          "He is sitting on the chair.",
          "The cat is sitting by the window.",
          "She is sitting at her desk.",
          "The dog is sitting on the floor.",
          "They are sitting in a row.",
          "I am sitting next to my friend."
        ]
      },
      "watching": {
        def: "Looking at something for a while.",
        ex: [
          "I am watching TV.",
          "She is watching the birds.",
          "He is watching the game.",
          "We are watching the movie.",
          "The cat is watching the fish.",
          "They are watching the clouds."
        ]
      },
      "him": {
        def: "A word used to talk about a boy or man.",
        ex: [
          "I saw him at school.",
          "She gave him a book.",
          "He called him yesterday.",
          "They like him a lot.",
          "The teacher helped him.",
          "We played with him."
        ]
      },
      "from": {
        def: "Starting at a place or time.",
        ex: [
          "She came from school.",
          "The letter is from my friend.",
          "He ran from the house.",
          "The smell comes from the kitchen.",
          "We learned from the teacher.",
          "The dog came from the yard."
        ]
      },
      "above": {
        def: "At a higher place than something else.",
        ex: [
          "The bird flies above the trees.",
          "The lamp is above the table.",
          "The sun is above us.",
          "The picture hangs above the bed.",
          "The cloud is above the mountain.",
          "The plane is above the city."
        ]
      },
      "moved": {
        def: "Changed place or position.",
        ex: [
          "He moved to a new house.",
          "The car moved fast.",
          "She moved her chair.",
          "The dog moved closer.",
          "The leaf moved in the wind.",
          "They moved the box."
        ]
      },
      "past": {
        def: "To go by or move beyond something.",
        ex: [
          "He walked past the store.",
          "The car drove past the house.",
          "She ran past her friend.",
          "The ball rolled past me.",
          "We went past the park.",
          "The bird flew past the window."
        ]
      },
      "careful": {
        def: "Trying not to make a mistake or get hurt.",
        ex: [
          "Be careful with the glass.",
          "She is careful when crossing the street.",
          "He is careful with his toys.",
          "The cat is careful not to fall.",
          "We are careful with the paint.",
          "They are careful in the kitchen."
        ]
      },
      "not": {
        def: "Shows the opposite or means 'no.'",
        ex: [
          "I am not tired.",
          "She did not eat.",
          "He is not here.",
          "We are not ready.",
          "They do not know.",
          "The dog is not barking."
        ]
      },
      "make": {
        def: "To create or do something.",
        ex: [
          "I make a cake.",
          "She can make a drawing.",
          "He will make a card.",
          "We make a plan.",
          "They make a noise.",
          "The dog can make a mess."
        ]
      },
      "sound": {
        def: "Something you can hear.",
        ex: [
          "The bell makes a sound.",
          "I heard a loud sound.",
          "The sound of music is nice.",
          "The dog made a sound.",
          "She likes the sound of rain.",
          "The car made a funny sound."
        ]
      },
      "tiptoed": {
        def: "Walked quietly on your toes.",
        ex: [
          "He tiptoed across the room.",
          "She tiptoed past the baby.",
          "The cat tiptoed on the rug.",
          "They tiptoed down the hall.",
          "I tiptoed to the door.",
          "The mouse tiptoed by."
        ]
      },
      "behind": {
        def: "At the back of something.",
        ex: [
          "The cat is behind the couch.",
          "He stood behind the door.",
          "She hid behind the tree.",
          "The dog ran behind the house.",
          "They are behind the line.",
          "The ball is behind the chair."
        ]
      },
      "bush": {
        def: "A low plant with many small branches.",
        ex: [
          "The bird is in the bush.",
          "She hid behind the bush.",
          "The bush has green leaves.",
          "He saw a bug on the bush.",
          "The bush is near the fence.",
          "We planted a bush."
        ]
      },
      "hiding": {
        def: "Staying out of sight so no one can see you.",
        ex: [
          "The cat is hiding under the bed.",
          "She is hiding behind the door.",
          "He is hiding in the closet.",
          "The rabbit is hiding in the grass.",
          "They are hiding from the rain.",
          "The puppy is hiding behind the couch."
        ]
      },
      "gardener": {
        def: "A person who takes care of a garden.",
        ex: [
          "The gardener waters the plants.",
          "She is the gardener of the park.",
          "The gardener grows flowers.",
          "He is a good gardener.",
          "The gardener pulls weeds.",
          "The gardener plants seeds."
        ]
      },
      "bird": {
        def: "An animal with wings and feathers that can fly.",
        ex: [
          "The bird sings in the tree.",
          "She saw a blue bird.",
          "The bird built a nest.",
          "He feeds the bird.",
          "The bird flies high.",
          "We watched the bird."
        ]
      },
      "sang": {
        def: "Made music with your voice.",
        ex: [
          "She sang a song.",
          "He sang in the shower.",
          "The bird sang in the morning.",
          "They sang together.",
          "I sang for my friend.",
          "The class sang loudly."
        ]
      },
      "branch": {
        def: "A part of a tree that grows out from the trunk.",
        ex: [
          "The bird sits on the branch.",
          "She climbed the branch.",
          "The apple hangs from the branch.",
          "He broke a branch.",
          "The branch is long.",
          "Leaves grow on the branch."
        ]
      },
      "filling": {
        def: "Making something full.",
        ex: [
          "He is filling the cup.",
          "The rain is filling the bucket.",
          "She is filling the box with toys.",
          "The sound is filling the room.",
          "The bird is filling the nest.",
          "The air is filling the balloon."
        ]
      },
      "air": {
        def: "The stuff we breathe that is all around us.",
        ex: [
          "We breathe air.",
          "The air is fresh outside.",
          "The bird flies in the air.",
          "The air feels warm.",
          "The air moves the leaves.",
          "He smells the air."
        ]
      },
      "with": {
        def: "Having or using something.",
        ex: [
          "She came with her friend.",
          "He drew with a pencil.",
          "I play with my dog.",
          "We eat with a spoon.",
          "They sing with joy.",
          "The box is filled with toys."
        ]
      },
      "sweet": {
        def: "Tastes like sugar or honey.",
        ex: [
          "The candy is sweet.",
          "She likes sweet apples.",
          "The cake is sweet.",
          "The juice is sweet.",
          "The smell is sweet.",
          "The fruit tastes sweet."
        ]
      },
      "music": {
        def: "Pleasant sounds made by singing or playing instruments.",
        ex: [
          "She listens to music.",
          "He plays music on the piano.",
          "The music is loud.",
          "We dance to music.",
          "Music makes me happy.",
          "The music is soft."
        ]
      },
      "hurried": {
        def: "Moved or did something quickly.",
        ex: [
          "He hurried to school.",
          "She hurried home.",
          "They hurried to the bus.",
          "I hurried to finish.",
          "The dog hurried after the ball.",
          "We hurried to the store."
        ]
      },
      "through": {
        def: "Going in one side and out the other.",
        ex: [
          "He walked through the door.",
          "She ran through the park.",
          "The ball rolled through the tunnel.",
          "We drove through the city.",
          "They went through the gate.",
          "The river flows through the town."
        ]
      },
      "rows": {
        def: "Lines of things placed side by side.",
        ex: [
          "The rows of chairs are straight.",
          "There are rows of trees.",
          "The garden has rows of carrots.",
          "We sat in rows.",
          "The books are in rows.",
          "The desks are in rows."
        ]
      },
      "dreaming": {
        def: "Thinking about something you want or imagine.",
        ex: [
          "She is dreaming of a puppy.",
          "He is dreaming about summer.",
          "I am dreaming of cake.",
          "They are dreaming of fun.",
          "The boy is dreaming at night.",
          "We are dreaming of a trip."
        ]
      },
      "home": {
        def: "The place where you live.",
        ex: [
          "I go home after school.",
          "She is at home.",
          "He likes his home.",
          "We eat dinner at home.",
          "They play at home.",
          "The dog waits at home."
        ]
      },
      "and": {
        def: "Used to join words or groups of words.",
        ex: [
          "I have a cat and a dog.",
          "She likes apples and oranges.",
          "We run and jump.",
          "He reads and writes.",
          "The sun and moon are in the sky.",
          "They laugh and smile."
        ]
      },
      "safety": {
        def: "Being safe from harm or danger.",
        ex: [
          "Wear a helmet for safety.",
          "Safety is important.",
          "The teacher talks about safety.",
          "We care about your safety.",
          "Safety rules help us.",
          "The safety sign is red."
        ]
      }
    };

    // Helper: get the story sentence containing a word index
    function getSentenceForWord(idx) {
      // Get story text as plain string
      const story = document.getElementById('story-text').innerText;
      // Find sentence boundaries
      let start = story.lastIndexOf('.', idx - 1) + 1;
      let end = story.indexOf('.', idx);
      if (end === -1) end = story.length;
      let sent = story.substring(start, end).trim();
      if (!sent.endsWith('.')) sent += '.';
      return sent;
    }

    // Helper: get the sentence containing a word element
    function getSentenceForElem(elem) {
      // Find the sentence containing this element in the DOM
      let node = elem;
      while (node && node.parentNode && node.parentNode.id !== 'story-text') {
        node = node.parentNode;
      }
      // Find all .uword in #story-text
      const all = Array.from(document.querySelectorAll('#story-text .uword'));
      // Find the index of the clicked word
      const idx = all.indexOf(elem);
      // Build text up to and after idx to find sentence boundaries
      let before = '', after = '';
      for (let i = 0; i < idx; ++i) before += all[i].innerText + ' ';
      for (let i = idx + 1; i < all.length; ++i) after += all[i].innerText + ' ';
      // Find the closest '.' before and after
      const storyText = document.getElementById('story-text').innerText;
      let charStart = 0, charEnd = storyText.length;
      let running = '';
      for (let i = 0; i < all.length; ++i) {
        running += all[i].innerText;
        if (i < idx) running += ' ';
      }
      charStart = running.lastIndexOf('.') + 1;
      running = '';
      for (let i = 0; i <= idx; ++i) {
        running += all[i].innerText + ' ';
      }
      let rest = '';
      for (let i = idx + 1; i < all.length; ++i) {
        rest += all[i].innerText + ' ';
      }
      let dotAfter = rest.indexOf('.');
      if (dotAfter === -1) charEnd = storyText.length;
      else charEnd = running.length + dotAfter;
      let sent = storyText.substring(charStart, charEnd).trim();
      if (!sent.endsWith('.')) sent += '.';
      return sent;
    }

    // Helper: get bounding rect relative to #story
    function getRelativeRect(child, parent) {
      const crect = child.getBoundingClientRect();
      const prect = parent.getBoundingClientRect();
      return {
        top: crect.top - prect.top,
        left: crect.left - prect.left,
        width: crect.width,
        height: crect.height
      };
    }

    // Remove any open popups and highlights
    function closePopups() {
      document.querySelectorAll('.popup').forEach(p => p.remove());
      document.querySelectorAll('.uword.selected').forEach(e => e.classList.remove('selected'));
    }

    // Show popup for a regular word
    function showWordPopup(word, elem) {
      closePopups();
      elem.classList.add('selected');
      const storyBox = document.getElementById('story');
      // Get bounding rect of word and story
      const wrect = getRelativeRect(elem, storyBox);
      // Build popup
      const popup = document.createElement('div');
      popup.className = 'popup';
      popup.tabIndex = -1;
      // Close button
      const closeBtn = document.createElement('button');
      closeBtn.className = 'close-btn';
      closeBtn.innerText = 'X';
      closeBtn.onclick = closePopups;
      popup.appendChild(closeBtn);
      // Word at top
      const wordDiv = document.createElement('div');
      wordDiv.className = 'popup-word';
      wordDiv.innerText = word;
      popup.appendChild(wordDiv);
      // Definition
      const defDiv = document.createElement('div');
      defDiv.className = 'popup-def';
      defDiv.innerText = wordDefs[word].def;
      popup.appendChild(defDiv);
      // Examples
      const exDiv = document.createElement('div');
      exDiv.className = 'popup-examples';
      wordDefs[word].ex.forEach(s => {
        const ex = document.createElement('span');
        ex.innerText = s;
        exDiv.appendChild(ex);
      });
      popup.appendChild(exDiv);
      // Add popup to story
      storyBox.appendChild(popup);
      // Position popup
      setTimeout(() => {
        const storyRect = storyBox.getBoundingClientRect();
        const popupRect = popup.getBoundingClientRect();
        let top = wrect.top + wrect.height + 4;
        let left = (storyRect.width - popupRect.width) / 2;
        if (left < 0) left = 0;
        // Prevent overflow below
        if (top + popupRect.height > storyRect.height) {
          top = storyRect.height - popupRect.height - 10;
          if (top < 0) top = 0;
        }
        popup.style.top = `${top}px`;
        popup.style.left = `1em`;
      }, 10);
    }

    // Show popup for preposition
    function showPrepPopup(prep, elem) {
      closePopups();
      elem.classList.add('selected');
      const storyBox = document.getElementById('story');
      // Get bounding rect of word and story
      const wrect = getRelativeRect(elem, storyBox);
      // Build popup
      const popup = document.createElement('div');
      popup.className = 'popup';
      popup.tabIndex = -1;
      // Close button
      const closeBtn = document.createElement('button');
      closeBtn.className = 'close-btn';
      closeBtn.innerText = 'X';
      closeBtn.onclick = closePopups;
      popup.appendChild(closeBtn);
      // Preposition at top
      const wordDiv = document.createElement('div');
      wordDiv.className = 'popup-word';
      wordDiv.innerText = prep;
      popup.appendChild(wordDiv);
      // Find the sentence containing this preposition
      const sentence = getSentenceForElem(elem);
      // Underline only the clicked preposition in the sentence
      const sentDiv = document.createElement('div');
      sentDiv.className = 'popup-sentence';
      // Underline only the first instance of prep in sentence
      let idx = sentence.toLowerCase().indexOf(prep.toLowerCase());
      if (idx !== -1) {
        sentDiv.innerHTML =
          sentence.substring(0, idx) +
          '<span style="text-decoration: underline; text-underline-offset:0.13em; text-decoration-thickness:0.13em;">' +
          sentence.substring(idx, idx + prep.length) +
          '</span>' +
          sentence.substring(idx + prep.length);
      } else {
        sentDiv.innerText = sentence;
      }
      popup.appendChild(sentDiv);
      // Prompt
      const promptDiv = document.createElement('div');
      promptDiv.className = 'popup-prompt';
      promptDiv.innerText = 'Pick the best meaning below.';
      popup.appendChild(promptDiv);
      // Definitions list
      const defsDiv = document.createElement('div');
      defsDiv.className = 'popup-defs-list';
      let defs = jasonPreps[prep];
      if (!defs) {
        // Not in Jason dictionary: fallback
        defs = [{
          def: "Shows the relationship of one thing to another.",
          ex: [
            `The ball is ${prep} the box.`,
            `She sits ${prep} the chair.`,
            `He walked ${prep} the street.`,
            `The dog ran ${prep} the house.`,
            `We looked ${prep} the window.`,
            `The cat is ${prep} the table.`
          ]
        }];
      }
      defs.forEach((d, i) => {
        const btn = document.createElement('button');
        btn.className = 'popup-def-choice';
        btn.innerText = d.def;
        btn.onclick = (e) => {
          e.stopPropagation();
          showPrepExamplesPopup(prep, d, elem, btn, popup, wrect);
        };
        defsDiv.appendChild(btn);
      });
      popup.appendChild(defsDiv);
      // Add popup to story
      storyBox.appendChild(popup);
      // Position popup
      setTimeout(() => {
        const storyRect = storyBox.getBoundingClientRect();
        const popupRect = popup.getBoundingClientRect();
        let top = wrect.top + wrect.height + 4;
        let left = (storyRect.width - popupRect.width) / 2;
        if (left < 0) left = 0;
        // Prevent overflow below
        if (top + popupRect.height > storyRect.height) {
          top = storyRect.height - popupRect.height - 10;
          if (top < 0) top = 0;
        }
        popup.style.top = `${top}px`;
        popup.style.left = `1em`;
      }, 10);
    }

    // Show popup for preposition example sentences (after picking a definition)
    function showPrepExamplesPopup(prep, defObj, elem, btn, parentPopup, wrect) {
      // Remove any previous example popups
      document.querySelectorAll('.popup.examples-popup').forEach(p => p.remove());
      // Mark this btn as selected
      parentPopup.querySelectorAll('.popup-def-choice').forEach(b => b.classList.remove('selected'));
      btn.classList.add('selected');
      // Build popup
      const storyBox = document.getElementById('story');
      const popup = document.createElement('div');
      popup.className = 'popup examples-popup';
      popup.tabIndex = -1;
      // Close button
      const closeBtn = document.createElement('button');
      closeBtn.className = 'close-btn';
      closeBtn.innerText = 'X';
      closeBtn.onclick = closePopups;
      popup.appendChild(closeBtn);
      // Preposition at top
      const wordDiv = document.createElement('div');
      wordDiv.className = 'popup-word';
      wordDiv.innerText = prep;
      popup.appendChild(wordDiv);
      // Examples
      const exDiv = document.createElement('div');
      exDiv.className = 'popup-examples';
      let count = 0;
      defObj.ex.forEach(s => {
        // Underline prep in each example
        let idx = s.toLowerCase().indexOf(prep.toLowerCase());
        let str;
        if (idx !== -1) {
          str = s.substring(0, idx) +
            '<span style="text-decoration: underline; text-underline-offset:0.13em; text-decoration-thickness:0.13em;">' +
            s.substring(idx, idx + prep.length) +
            '</span>' +
            s.substring(idx + prep.length);
        } else {
          str = s;
        }
        const ex = document.createElement('span');
        ex.innerHTML = str;
        exDiv.appendChild(ex);
        count++;
      });
      // If fewer than 6, pad with generic
      while (count < 6) {
        const s = `The cat is ${prep} the box.`;
        let idx = s.toLowerCase().indexOf(prep.toLowerCase());
        let str = s.substring(0, idx) +
          '<span style="text-decoration: underline; text-underline-offset:0.13em; text-decoration-thickness:0.13em;">' +
          s.substring(idx, idx + prep.length) +
          '</span>' +
          s.substring(idx + prep.length);
        const ex = document.createElement('span');
        ex.innerHTML = str;
        exDiv.appendChild(ex);
        count++;
      }
      popup.appendChild(exDiv);
      // Add popup to story
      storyBox.appendChild(popup);
      // Position popup
      setTimeout(() => {
        const storyRect = storyBox.getBoundingClientRect();
        const parentRect = parentPopup.getBoundingClientRect();
        const popupRect = popup.getBoundingClientRect();
        let top = parentRect.bottom - storyRect.top + 4;
        // Prevent overflow below
        if (top + popupRect.height > storyRect.height) {
          top = storyRect.height - popupRect.height - 10;
          if (top < 0) top = 0;
        }
        popup.style.top = `${top}px`;
        popup.style.left = `1em`;
      }, 10);
    }

    // Attach click handlers to all underlined words
    document.querySelectorAll('.uword').forEach(elem => {
      elem.addEventListener('click', function(e) {
        e.stopPropagation();
        const word = elem.getAttribute('data-word');
        const prep = elem.getAttribute('data-prep');
        if (prep && jasonPreps.hasOwnProperty(prep)) {
          showPrepPopup(prep, elem);
        } else if (prep) {
          showPrepPopup(prep, elem);
        } else if (wordDefs.hasOwnProperty(word)) {
          showWordPopup(word, elem);
        } else {
          // Fallback: show basic definition
          showWordPopup(word, elem);
        }
      });
    });

    // Close popups on click outside
    document.addEventListener('click', function(e) {
      if (!e.target.closest('.popup')) closePopups();
    });

    // Keyboard: escape closes popup
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') closePopups();
    });
  </script>
</body>
</html>
