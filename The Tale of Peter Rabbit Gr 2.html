<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>The Tale of Peter Rabbit - Grade Two</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #f8fbff;
    }
    body {
      min-height: 100vh;
      width: 100vw;
      box-sizing: border-box;
      font-family: 'Segoe UI', Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }
    #story {
      position: relative;
      width: 100vw;
      max-width: 900px;
      margin: 0 auto;
      padding: 1.5em 1em 4em 1em;
      background: #fff;
      box-sizing: border-box;
      min-height: 100vh;
      border-radius: 0.5em;
      box-shadow: 0 2px 16px rgba(0,0,0,0.08);
    }
    .story-text {
      font-size: 2.2em;
      font-weight: bold;
      line-height: 1.35;
      color: #222;
      width: 100%;
      letter-spacing: 0.01em;
      word-break: break-word;
      user-select: none;
    }
    .uword {
      text-decoration: underline;
      text-decoration-thickness: 0.12em;
      text-underline-offset: 0.18em;
      cursor: pointer;
      transition: background 0.15s;
      border-radius: 0.18em;
      padding: 0 0.08em;
      margin: 0 0.02em;
      background: transparent;
    }
    .uword.active {
      background: #cce7ff !important;
      color: #0a2e52;
    }
    .popup {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      min-width: 220px;
      max-width: calc(100% - 2em);
      width: calc(100% - 2em);
      background: #f3faff;
      border: 2px solid #5eb3ff;
      border-radius: 0.5em;
      box-shadow: 0 6px 32px rgba(0,80,180,0.11);
      z-index: 100;
      padding: 0.7em 1em 1.2em 1em;
      box-sizing: border-box;
      font-size: 2em;
      font-weight: bold;
      color: #183b5b;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      justify-content: flex-start;
      overflow: visible;
    }
    .popup .close-btn {
      position: absolute;
      top: 0.4em;
      right: 0.7em;
      font-size: 1.2em;
      font-weight: bold;
      color: #2677c9;
      background: none;
      border: none;
      cursor: pointer;
      padding: 0;
      margin: 0;
      z-index: 10;
      transition: color 0.13s;
    }
    .popup .close-btn:hover {
      color: #c00;
    }
    .popup-word {
      text-align: center;
      font-size: 1.25em;
      font-weight: bold;
      margin: 0.22em 0 0.2em 0;
      letter-spacing: 0.01em;
      color: #0b3f6a;
    }
    .popup-sentence {
      text-align: center;
      font-size: 0.9em;
      margin: 0.22em 0 0.2em 0;
      color: #1b4c6a;
      font-weight: bold;
      width: 100%;
    }
    .popup-def {
      text-align: center;
      font-size: 0.93em;
      font-weight: bold;
      margin: 0.35em 0 0.4em 0;
      color: #205e8b;
      width: 100%;
    }
    .popup-examples {
      width: 100%;
      margin: 0.3em 0 0 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: 0.22em;
    }
    .popup-example {
      font-size: 0.8em;
      font-weight: bold;
      color: #26527c;
      text-align: center;
      width: 100%;
      margin: 0;
      padding: 0;
      line-height: 1.18;
    }
    .popup-def-list {
      width: 100%;
      max-height: 7.7em;
      overflow-y: auto;
      margin: 0.35em 0 0 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: 0.24em;
    }
    .popup-def-choice {
      background: #e7f3ff;
      border: 2px solid #a3d6ff;
      border-radius: 0.3em;
      font-size: 0.88em;
      font-weight: bold;
      color: #1b4c6a;
      cursor: pointer;
      padding: 0.25em 0.1em;
      margin: 0;
      text-align: center;
      width: 100%;
      transition: background 0.12s, border 0.12s;
      outline: none;
    }
    .popup-def-choice:active, .popup-def-choice.selected {
      background: #b8e2ff;
      border-color: #5eb3ff;
      color: #0c2d4a;
    }
    .popup-prompt {
      text-align: center;
      font-size: 0.78em;
      color: #1d4d7a;
      margin: 0.3em 0 0.3em 0;
      font-weight: bold;
      width: 100%;
    }
    @media (max-width: 600px) {
      #story {
        padding: 1em 0.2em 3em 0.2em;
      }
      .story-text {
        font-size: 2em;
      }
      .popup {
        font-size: 1.4em;
      }
    }
  </style>
</head>
<body>
  <div id="story">
    <div class="story-text" id="storyText">
      <span class="uword" data-word="Peter">Peter</span> 
      <span class="uword" data-word="hopped">hopped</span> 
      <span class="uword" data-word="in" data-prep="in">in</span> 
      the 
      <span class="uword" data-word="garden">garden</span>, 
      <span class="uword" data-word="looking">looking</span> 
      <span class="uword" data-word="for">for</span> 
      <span class="uword" data-word="something">something</span> 
      <span class="uword" data-word="to" data-prep="to">to</span> 
      <span class="uword" data-word="eat">eat</span>. 
      He 
      <span class="uword" data-word="squeezed">squeezed</span> 
      <span class="uword" data-word="under">under</span> 
      the 
      <span class="uword" data-word="gate">gate</span>, 
      <span class="uword" data-word="hoping">hoping</span> 
      <span class="uword" data-word="to" data-prep="to">to</span> 
      <span class="uword" data-word="find">find</span> 
      a 
      <span class="uword" data-word="snack">snack</span>. 
      A 
      <span class="uword" data-word="row">row</span> 
      <span class="uword" data-word="of" data-prep="of">of</span> 
      <span class="uword" data-word="carrots">carrots</span> 
      <span class="uword" data-word="grew">grew</span> 
      <span class="uword" data-word="in" data-prep="in">in</span> 
      the 
      <span class="uword" data-word="soft">soft</span> 
      <span class="uword" data-word="dirt">dirt</span>, 
      <span class="uword" data-word="bright">bright</span> 
      <span class="uword" data-word="in" data-prep="in">in</span> 
      the 
      <span class="uword" data-word="morning">morning</span> 
      <span class="uword" data-word="sun">sun</span>. 
      <span class="uword" data-word="Peter">Peter</span> 
      <span class="uword" data-word="nibbled">nibbled</span> 
      <span class="uword" data-word="on" data-prep="on">on</span> 
      a 
      <span class="uword" data-word="leaf">leaf</span>, 
      <span class="uword" data-word="feeling">feeling</span> 
      <span class="uword" data-word="happy">happy</span> 
      <span class="uword" data-word="in" data-prep="in">in</span> 
      the 
      <span class="uword" data-word="cool">cool</span> 
      <span class="uword" data-word="shade">shade</span>. 
      He 
      <span class="uword" data-word="saw">saw</span> 
      a 
      <span class="uword" data-word="big">big</span> 
      <span class="uword" data-word="cat">cat</span> 
      <span class="uword" data-word="sitting">sitting</span> 
      <span class="uword" data-word="on" data-prep="on">on</span> 
      a 
      <span class="uword" data-word="wall">wall</span>, 
      <span class="uword" data-word="watching">watching</span> 
      him 
      <span class="uword" data-word="from">from</span> 
      <span class="uword" data-word="above">above</span>. 
      <span class="uword" data-word="Peter">Peter</span> 
      <span class="uword" data-word="moved">moved</span> 
      <span class="uword" data-word="past">past</span> 
      the 
      <span class="uword" data-word="cat">cat</span>, 
      <span class="uword" data-word="careful">careful</span> 
      <span class="uword" data-word="not">not</span> 
      <span class="uword" data-word="to" data-prep="to">to</span> 
      <span class="uword" data-word="make">make</span> 
      a 
      <span class="uword" data-word="sound">sound</span>. 
      He 
      <span class="uword" data-word="tiptoed">tiptoed</span> 
      <span class="uword" data-word="behind">behind</span> 
      a 
      <span class="uword" data-word="bush">bush</span>, 
      <span class="uword" data-word="hiding">hiding</span> 
      <span class="uword" data-word="from">from</span> 
      the 
      <span class="uword" data-word="gardener">gardener</span>. 
      A 
      <span class="uword" data-word="bird">bird</span> 
      <span class="uword" data-word="sang">sang</span> 
      <span class="uword" data-word="on" data-prep="on">on</span> 
      a 
      <span class="uword" data-word="branch">branch</span>, 
      <span class="uword" data-word="filling">filling</span> 
      the 
      <span class="uword" data-word="air">air</span> 
      <span class="uword" data-word="with">with</span> 
      <span class="uword" data-word="sweet">sweet</span> 
      <span class="uword" data-word="music">music</span>. 
      <span class="uword" data-word="Peter">Peter</span> 
      <span class="uword" data-word="hurried">hurried</span> 
      <span class="uword" data-word="through">through</span> 
      the 
      <span class="uword" data-word="rows">rows</span>, 
      <span class="uword" data-word="dreaming">dreaming</span> 
      <span class="uword" data-word="of" data-prep="of">of</span> 
      <span class="uword" data-word="home">home</span> 
      <span class="uword" data-word="and">and</span> 
      <span class="uword" data-word="safety">safety</span>.
    </div>
  </div>
  <script>
    // Jason dictionary (prepositions only, loaded from attached file)
    const jasonPreps = {
      "to": [
        { def: "the direction of", examples: [
          "We go to school every day.",
          "She walks to the store.",
          "Give the toy to your friend.",
          "The dog ran to the door.",
          "He pointed to the sky.",
          "Mom drove to work."
        ]},
        { def: "as far", examples: [
          "Walk to the end of the street.",
          "Run to the big tree.",
          "She read to page ten.",
          "Draw a line to the corner.",
          "We played to the last minute.",
          "He jumped to the top step."
        ]},
        { def: "until or up to a time", examples: [
          "Wait to the bell rings.",
          "Stay here to five o'clock.",
          "She worked to lunchtime.",
          "I will sleep to morning.",
          "Read to the end of the story.",
          "We can play to dinner."
        ]},
        { def: "touching or leaning against something", examples: [
          "The bike is leaning to the wall.",
          "She pressed her ear to the door.",
          "Put your hand to your heart.",
          "He glued the paper to the board.",
          "The puppy snuggled to my leg.",
          "The sign was nailed to the tree."
        ]},
        { def: "for the purpose of", examples: [
          "She went to the store to buy milk.",
          "He called to ask a question.",
          "We study to learn.",
          "They ran to catch the bus.",
          "I came to help you.",
          "She smiled to show she was happy."
        ]},
        { def: "related to or causing something", examples: [
          "The noise led to a complaint.",
          "His hard work led to success.",
          "Rain can lead to flooding.",
          "A cold can lead to a cough.",
          "The story led to laughter.",
          "The mistake led to a new idea."
        ]},
        { def: "alongside or belonging with something", examples: [
          "The answer is next to the question.",
          "The picture belongs to the book.",
          "The key is to the lock.",
          "The shoes are to the outfit.",
          "The lid is to the jar.",
          "The leash is to the dog."
        ]},
        { def: "showing how two things are similar or different", examples: [
          "Ice is cold compared to fire.",
          "My bag is bigger to yours.",
          "This book is easy to that one.",
          "The red car is fast to the blue one.",
          "Math is hard to some kids.",
          "Summer is hot to winter."
        ]},
        { def: "in agreement with", examples: [
          "She is true to her word.",
          "He acted to the rules.",
          "The answer is right to the teacher.",
          "I will be kind to my friends.",
          "We listened to the leader.",
          "She played to the plan."
        ]},
        { def: "in or for each", examples: [
          "There are five apples to each basket.",
          "Two students to a desk.",
          "One cookie to every child.",
          "Ten points to a game.",
          "Four wheels to a car.",
          "Three books to a shelf."
        ]},
        { def: "showing who is receiving something", examples: [
          "Give the letter to Sam.",
          "She handed the toy to her brother.",
          "Pass the salt to me.",
          "Send the gift to your friend.",
          "The teacher gave homework to the class.",
          "I told the story to my mom."
        ]}
      ],
      "of": [
        { def: "coming from", examples: [
          "The smell of cookies is nice.",
          "A cup of water is on the table.",
          "The sound of music filled the room.",
          "A piece of cake for you.",
          "A group of kids played outside.",
          "A bag of apples is heavy."
        ]},
        { def: "resulting from", examples: [
          "The joy of winning is great.",
          "The pain of falling hurt.",
          "The fun of playing is the best.",
          "The noise of cars is loud.",
          "The mess of painting is big.",
          "The taste of candy is sweet."
        ]},
        { def: "at a distance from", examples: [
          "The school is east of my house.",
          "The park is north of the library.",
          "The cat is far of the door.",
          "The tree is left of the bench.",
          "The ball is right of the chair.",
          "The store is south of the station."
        ]},
        { def: "by", examples: [
          "A book of poems by Maya.",
          "A painting of the artist.",
          "A song of the singer.",
          "A letter of my friend.",
          "A story of the writer.",
          "A drawing of the child."
        ]},
        { def: "separated from", examples: [
          "A piece of the puzzle is missing.",
          "A part of the cake was eaten.",
          "A slice of bread is on the plate.",
          "A bit of the toy broke.",
          "A drop of water fell.",
          "A chunk of ice melted."
        ]},
        { def: "taken out of a group or a whole number", examples: [
          "Three of the five dogs barked.",
          "Half of the class left early.",
          "Most of the apples are red.",
          "Some of the kids are tall.",
          "Many of the books are new.",
          "One of the cars is blue."
        ]},
        { def: "made from", examples: [
          "A shirt of cotton feels soft.",
          "A table of wood is strong.",
          "A ring of gold is shiny.",
          "A cup of glass is clear.",
          "A hat of straw is light.",
          "A blanket of wool is warm."
        ]},
        { def: "belonging to", examples: [
          "The toys of the children are everywhere.",
          "The books of the library are old.",
          "The keys of the car are lost.",
          "The name of the school is long.",
          "The songs of the birds are pretty.",
          "The color of the sky is blue."
        ]},
        { def: "having or owning", examples: [
          "A girl of many talents.",
          "A man of great strength.",
          "A dog of quick speed.",
          "A team of good players.",
          "A house of many rooms.",
          "A boy of kind heart."
        ]},
        { def: "including", examples: [
          "The bag of candy has gum, too.",
          "The box of toys has cars and dolls.",
          "The list of chores has sweeping.",
          "The set of crayons has red and blue.",
          "The class of students has boys and girls.",
          "The team of players has new members."
        ]},
        { def: "that is", examples: [
          "The city of Paris is in France.",
          "The month of June is hot.",
          "The animal of the year is the tiger.",
          "The color of the day is yellow.",
          "The book of the week is fun.",
          "The food of the day is pizza."
        ]},
        { def: "about or concerning", examples: [
          "The story of the hero is exciting.",
          "The talk of the weather was long.",
          "The lesson of math is hard.",
          "The news of the day is sad.",
          "The question of the test is tricky.",
          "The problem of the puzzle is tough."
        ]},
        { def: "during", examples: [
          "The fun of summer is swimming.",
          "The joy of holidays is gifts.",
          "The work of the day is done.",
          "The games of recess are fun.",
          "The study of night is quiet.",
          "The sleep of winter is deep."
        ]},
        { def: "before a certain time", examples: [
          "The end of the week is Friday.",
          "The start of the day is morning.",
          "The close of school is June.",
          "The finish of the race is near.",
          "The last of the month is coming.",
          "The close of class is soon."
        ]}
      ],
      "in": [
        { def: "inside or surrounded by something", examples: [
          "The cat is in the box.",
          "Put the book in your bag.",
          "There is milk in the cup.",
          "The ball is in the basket.",
          "He is in the room.",
          "The dog sleeps in the bed."
        ]},
        { def: "during or after", examples: [
          "In the morning, we eat breakfast.",
          "We play in the afternoon.",
          "The stars come out in the night.",
          "She reads in the evening.",
          "We swim in the summer.",
          "It snows in the winter."
        ]},
        { def: "not beyond or not past", examples: [
          "Finish your work in ten minutes.",
          "Come back in an hour.",
          "We will leave in five days.",
          "The movie starts in a minute.",
          "I will be home in a while.",
          "He will call in a moment."
        ]},
        { def: "part of a group or category", examples: [
          "She is in the soccer team.",
          "He is in the choir.",
          "I am in the third grade.",
          "We are in the same class.",
          "The book is in the library.",
          "The painting is in the museum."
        ]},
        { def: "using something as a tool or method", examples: [
          "Write your answer in pencil.",
          "Say it in a loud voice.",
          "Draw in color.",
          "Explain in simple words.",
          "Sing in English.",
          "Count in twos."
        ]},
        { def: "because of", examples: [
          "He was late in traffic.",
          "She cried in pain.",
          "The team won in excitement.",
          "He laughed in surprise.",
          "She smiled in joy.",
          "They cheered in happiness."
        ]},
        { def: "moving inside something", examples: [
          "The fish swam in the water.",
          "The car drove in the tunnel.",
          "The bird flew in the sky.",
          "The kids ran in the gym.",
          "The train moves in the city.",
          "The dog ran in the field."
        ]}
      ],
      "on": [
        { def: "resting or attached to something", examples: [
          "The book is on the table.",
          "Put your shoes on the floor.",
          "The cat sits on the chair.",
          "The hat is on my head.",
          "The picture is on the wall.",
          "The cup is on the desk."
        ]},
        { def: "on the surface of", examples: [
          "The leaf is on the water.",
          "The bug is on the window.",
          "The snow is on the roof.",
          "The paint is on the paper.",
          "The crumbs are on the plate.",
          "The sticker is on the box."
        ]},
        { def: "next to or beside something", examples: [
          "Sit on my right.",
          "The dog is on my left.",
          "The lamp is on the side of the bed.",
          "The pen is on the edge of the desk.",
          "The shoes are on the side of the door.",
          "The bag is on the side of the chair."
        ]},
        { def: "at the time something happens", examples: [
          "On Monday, we have art class.",
          "The party is on my birthday.",
          "We go to the park on weekends.",
          "On holidays, we visit family.",
          "On rainy days, we stay inside.",
          "On the first day of school, we meet our teacher."
        ]},
        { def: "related to something", examples: [
          "She gave a talk on science.",
          "The book is on animals.",
          "We worked on a project.",
          "He wrote a story on friendship.",
          "The lesson is on math.",
          "They watched a movie on space."
        ]},
        { def: "because of", examples: [
          "He was late on account of traffic.",
          "She stayed home on doctor's orders.",
          "The game was canceled on account of rain.",
          "He smiled on hearing the news.",
          "She cried on seeing the puppy.",
          "He left on short notice."
        ]}
      ]
    };

    // Simple dictionary for all other words/idioms/contractions
    const wordDict = {
      "Peter": {
        def: "A rabbit's name in the story.",
        ex: [
          "Peter is a little rabbit.",
          "Peter likes to hop.",
          "Peter is curious.",
          "Peter has a blue coat.",
          "Peter loves carrots.",
          "Peter is the main character."
        ]
      },
      "hopped": {
        def: "Jumped with both feet together.",
        ex: [
          "The frog hopped away.",
          "She hopped on one foot.",
          "The bunny hopped in the grass.",
          "He hopped over a rock.",
          "The bird hopped on the ground.",
          "I hopped across the yard."
        ]
      },
      "garden": {
        def: "A place where plants and flowers grow.",
        ex: [
          "We have tomatoes in our garden.",
          "The garden is full of flowers.",
          "She waters the garden every day.",
          "The rabbit ran into the garden.",
          "There are carrots in the garden.",
          "The garden is behind the house."
        ]
      },
      "looking": {
        def: "Trying to see or find something.",
        ex: [
          "She is looking for her shoe.",
          "I am looking at the sky.",
          "He is looking for his dog.",
          "We are looking for the ball.",
          "The cat is looking at the bird.",
          "Are you looking for your book?"
        ]
      },
      "for": {
        def: "Trying to get or find something.",
        ex: [
          "She looks for her toy.",
          "He is waiting for his friend.",
          "We search for the answer.",
          "I am looking for my hat.",
          "Are you looking for the dog?",
          "They are looking for food."
        ]
      },
      "something": {
        def: "An unknown thing.",
        ex: [
          "I see something in the box.",
          "She wants something to eat.",
          "He found something shiny.",
          "There is something on the table.",
          "We heard something outside.",
          "Do you want something to drink?"
        ]
      },
      "eat": {
        def: "To put food in your mouth and chew it.",
        ex: [
          "I like to eat apples.",
          "She will eat her lunch.",
          "The dog likes to eat bones.",
          "We eat together at dinner.",
          "He wants to eat a snack.",
          "Do you eat breakfast?"
        ]
      },
      "squeezed": {
        def: "Pushed through a tight space.",
        ex: [
          "He squeezed through the door.",
          "The cat squeezed under the fence.",
          "She squeezed into her seat.",
          "The mouse squeezed into a hole.",
          "I squeezed past the boxes.",
          "We squeezed through the crowd."
        ]
      },
      "under": {
        def: "Below or beneath something.",
        ex: [
          "The cat is under the bed.",
          "He hid under the table.",
          "The dog sleeps under the chair.",
          "She found her shoe under the couch.",
          "The ball rolled under the car.",
          "We sat under the tree."
        ]
      },
      "gate": {
        def: "A door or opening in a fence or wall.",
        ex: [
          "Open the gate to the garden.",
          "The dog ran out the gate.",
          "She closed the gate.",
          "The gate is made of wood.",
          "He painted the gate blue.",
          "The gate swings open."
        ]
      },
      "hoping": {
        def: "Wishing for something to happen.",
        ex: [
          "I am hoping for good weather.",
          "She is hoping to win the game.",
          "He is hoping for a new toy.",
          "We are hoping for a fun day.",
          "Are you hoping to see your friend?",
          "They are hoping for a treat."
        ]
      },
      "find": {
        def: "To discover or see something you are looking for.",
        ex: [
          "I want to find my book.",
          "She can find her shoes.",
          "He will find the answer.",
          "We need to find the dog.",
          "Can you find your pencil?",
          "They find a treasure."
        ]
      },
      "snack": {
        def: "A small amount of food eaten between meals.",
        ex: [
          "I eat a snack after school.",
          "She wants a snack.",
          "He has a snack in his bag.",
          "We share our snacks.",
          "What snack do you like?",
          "The snack is yummy."
        ]
      },
      "row": {
        def: "A line of things or people.",
        ex: [
          "The chairs are in a row.",
          "We stand in a row.",
          "There is a row of flowers.",
          "The books are in a row.",
          "She planted seeds in a row.",
          "The ducks walk in a row."
        ]
      },
      "carrots": {
        def: "Orange vegetables that grow in the ground.",
        ex: [
          "Rabbits like carrots.",
          "She eats carrots for lunch.",
          "Carrots are orange.",
          "We grow carrots in the garden.",
          "He picked some carrots.",
          "Carrots are good for you."
        ]
      },
      "grew": {
        def: "Became bigger or developed.",
        ex: [
          "The plant grew tall.",
          "He grew fast last year.",
          "The tree grew new leaves.",
          "The puppy grew strong.",
          "Flowers grew in the yard.",
          "She grew her hair long."
        ]
      },
      "soft": {
        def: "Easy to press or not hard.",
        ex: [
          "The pillow is soft.",
          "The kitten has soft fur.",
          "The bread is soft.",
          "She likes soft blankets.",
          "The ground is soft after rain.",
          "The toy is soft."
        ]
      },
      "dirt": {
        def: "Loose earth or soil.",
        ex: [
          "The plant is in the dirt.",
          "He played in the dirt.",
          "There is dirt on my shoes.",
          "The dog dug in the dirt.",
          "Wash the dirt off your hands.",
          "The dirt is brown."
        ]
      },
      "bright": {
        def: "Giving lots of light or color.",
        ex: [
          "The sun is bright.",
          "She wore a bright dress.",
          "The room is bright.",
          "The star is bright at night.",
          "The light is very bright.",
          "His smile is bright."
        ]
      },
      "morning": {
        def: "The time of day when the sun comes up.",
        ex: [
          "I eat breakfast in the morning.",
          "She wakes up in the morning.",
          "The birds sing in the morning.",
          "We go to school in the morning.",
          "It is cool in the morning.",
          "Morning is my favorite time."
        ]
      },
      "sun": {
        def: "The bright star that lights the day.",
        ex: [
          "The sun is hot.",
          "The sun rises in the east.",
          "We play in the sun.",
          "The sun shines in the sky.",
          "The sun gives us light.",
          "The sun sets at night."
        ]
      },
      "nibbled": {
        def: "Ate with small bites.",
        ex: [
          "The mouse nibbled cheese.",
          "She nibbled on a cookie.",
          "The rabbit nibbled a carrot.",
          "He nibbled the apple.",
          "The bird nibbled seeds.",
          "I nibbled my snack."
        ]
      },
      "leaf": {
        def: "A flat, green part of a plant.",
        ex: [
          "The leaf is green.",
          "A leaf fell from the tree.",
          "The bug sits on the leaf.",
          "She picked up a leaf.",
          "The leaf is soft.",
          "I drew a leaf."
        ]
      },
      "feeling": {
        def: "Having an emotion or sense.",
        ex: [
          "She is feeling happy.",
          "I am feeling tired.",
          "He is feeling sad.",
          "We are feeling excited.",
          "Are you feeling better?",
          "The dog is feeling playful."
        ]
      },
      "happy": {
        def: "Glad or joyful.",
        ex: [
          "I am happy today.",
          "She is happy with her toy.",
          "He feels happy at school.",
          "We are happy to see you.",
          "The dog is happy.",
          "Are you happy now?"
        ]
      },
      "cool": {
        def: "A little bit cold.",
        ex: [
          "The water is cool.",
          "It is cool in the shade.",
          "The breeze is cool.",
          "I wear a jacket when it is cool.",
          "The night is cool.",
          "The room feels cool."
        ]
      },
      "shade": {
        def: "A place out of the sun.",
        ex: [
          "We sat in the shade.",
          "The tree gives shade.",
          "It is cool in the shade.",
          "The dog sleeps in the shade.",
          "She stood in the shade.",
          "The shade is nice on hot days."
        ]
      },
      "saw": {
        def: "Looked at or noticed.",
        ex: [
          "I saw a bird.",
          "She saw a rainbow.",
          "He saw his friend.",
          "We saw a movie.",
          "The cat saw the mouse.",
          "They saw the sun rise."
        ]
      },
      "big": {
        def: "Large in size.",
        ex: [
          "The dog is big.",
          "She has a big smile.",
          "The house is big.",
          "The tree is big and tall.",
          "He made a big cake.",
          "The box is big."
        ]
      },
      "cat": {
        def: "A small animal with fur and whiskers.",
        ex: [
          "The cat is soft.",
          "She has a pet cat.",
          "The cat sleeps on the bed.",
          "I see a black cat.",
          "The cat likes to play.",
          "The cat chased the mouse."
        ]
      },
      "sitting": {
        def: "Resting on your bottom.",
        ex: [
          "She is sitting on a chair.",
          "The cat is sitting by the window.",
          "He is sitting at the table.",
          "We are sitting in a row.",
          "The bird is sitting on a branch.",
          "I am sitting with my friend."
        ]
      },
      "wall": {
        def: "A flat side of a room or building.",
        ex: [
          "The picture is on the wall.",
          "He painted the wall blue.",
          "The ball hit the wall.",
          "She leaned against the wall.",
          "There is a clock on the wall.",
          "The wall is tall."
        ]
      },
      "watching": {
        def: "Looking at something for a while.",
        ex: [
          "I am watching TV.",
          "She is watching the birds.",
          "He is watching his dog.",
          "They are watching a movie.",
          "The cat is watching the fish.",
          "Are you watching the game?"
        ]
      },
      "from": {
        def: "Starting at a place or time.",
        ex: [
          "I am from this town.",
          "She walked from home.",
          "He is from another school.",
          "The letter is from my friend.",
          "The smell comes from the kitchen.",
          "We ran from the park."
        ]
      },
      "above": {
        def: "Over or higher than something.",
        ex: [
          "The bird flies above the trees.",
          "The light is above the table.",
          "The sun is above us.",
          "The picture hangs above the bed.",
          "The plane is above the clouds.",
          "The stars are above the earth."
        ]
      },
      "moved": {
        def: "Changed place or position.",
        ex: [
          "He moved to a new house.",
          "She moved her chair.",
          "The dog moved fast.",
          "We moved the table.",
          "The car moved down the street.",
          "I moved closer."
        ]
      },
      "past": {
        def: "Going by or beyond something.",
        ex: [
          "He walked past the store.",
          "The car drove past my house.",
          "She ran past her friend.",
          "The ball rolled past the chair.",
          "We went past the park.",
          "The bird flew past the window."
        ]
      },
      "careful": {
        def: "Trying not to make mistakes or get hurt.",
        ex: [
          "Be careful with the glass.",
          "She is careful when she cuts.",
          "He is careful crossing the street.",
          "We are careful with the dog.",
          "I am careful not to fall.",
          "They are careful at the pool."
        ]
      },
      "not": {
        def: "Shows something is not true.",
        ex: [
          "I am not tired.",
          "She is not here.",
          "We do not have school.",
          "He is not my brother.",
          "The cat is not big.",
          "It is not raining."
        ]
      },
      "make": {
        def: "To create or do something.",
        ex: [
          "I make a cake.",
          "She can make a drawing.",
          "He will make a toy.",
          "We make a plan.",
          "They make a mess.",
          "Can you make a sound?"
        ]
      },
      "sound": {
        def: "Something you can hear.",
        ex: [
          "I hear a sound.",
          "The dog made a sound.",
          "She likes music's sound.",
          "The sound is loud.",
          "What is that sound?",
          "Birds make a sweet sound."
        ]
      },
      "tiptoed": {
        def: "Walked quietly on your toes.",
        ex: [
          "She tiptoed across the room.",
          "He tiptoed past the dog.",
          "I tiptoed to the door.",
          "We tiptoed so we would not wake him.",
          "The cat tiptoed on the rug.",
          "They tiptoed around the toys."
        ]
      },
      "behind": {
        def: "At the back of something.",
        ex: [
          "The dog is behind the door.",
          "She stood behind her friend.",
          "The car is behind the house.",
          "He hid behind the tree.",
          "The cat is behind the couch.",
          "We are behind the line."
        ]
      },
      "bush": {
        def: "A small, leafy plant.",
        ex: [
          "The bird is in the bush.",
          "She hid behind the bush.",
          "He picked berries from the bush.",
          "The bush has green leaves.",
          "There is a bush by the gate.",
          "We planted a bush."
        ]
      },
      "hiding": {
        def: "Staying out of sight.",
        ex: [
          "The cat is hiding under the bed.",
          "She is hiding from her friend.",
          "He is hiding behind the door.",
          "We are hiding in the closet.",
          "The dog is hiding his bone.",
          "Are you hiding from me?"
        ]
      },
      "gardener": {
        def: "A person who takes care of a garden.",
        ex: [
          "The gardener waters the plants.",
          "She is a good gardener.",
          "The gardener plants flowers.",
          "He works as a gardener.",
          "The gardener pulls weeds.",
          "The gardener loves the garden."
        ]
      },
      "bird": {
        def: "An animal with feathers and wings.",
        ex: [
          "The bird sings in the tree.",
          "She saw a blue bird.",
          "The bird can fly.",
          "He fed the bird.",
          "The bird built a nest.",
          "We heard the bird sing."
        ]
      },
      "sang": {
        def: "Made music with your voice.",
        ex: [
          "She sang a song.",
          "The bird sang in the morning.",
          "He sang with his friends.",
          "We sang at school.",
          "The class sang together.",
          "I sang for my mom."
        ]
      },
      "branch": {
        def: "A part of a tree that grows out from the trunk.",
        ex: [
          "The bird sits on the branch.",
          "She climbed the branch.",
          "The branch is strong.",
          "Leaves grow on the branch.",
          "He broke a branch.",
          "The branch is high."
        ]
      },
      "filling": {
        def: "Making something full.",
        ex: [
          "She is filling her cup.",
          "The rain is filling the bucket.",
          "He is filling the box with toys.",
          "The room is filling with people.",
          "The jar is filling with water.",
          "The bag is filling with books."
        ]
      },
      "air": {
        def: "The invisible gas we breathe.",
        ex: [
          "We breathe air.",
          "The air is fresh.",
          "Birds fly in the air.",
          "The air smells sweet.",
          "The air is cool.",
          "She felt the air on her face."
        ]
      },
      "with": {
        def: "Having or using something.",
        ex: [
          "I go with my friend.",
          "She eats with a fork.",
          "He plays with a ball.",
          "We draw with crayons.",
          "The dog sleeps with the cat.",
          "Are you coming with us?"
        ]
      },
      "sweet": {
        def: "Tasting like sugar or very nice.",
        ex: [
          "The candy is sweet.",
          "She has a sweet smile.",
          "The fruit is sweet.",
          "His voice is sweet.",
          "The cake is sweet.",
          "I like sweet apples."
        ]
      },
      "music": {
        def: "Sounds that people make to sing or play.",
        ex: [
          "I like to listen to music.",
          "She plays music on the piano.",
          "He sings music at school.",
          "Music makes me happy.",
          "We dance to music.",
          "The music is loud."
        ]
      },
      "hurried": {
        def: "Moved quickly.",
        ex: [
          "She hurried to school.",
          "He hurried home.",
          "I hurried to the bus.",
          "They hurried to the park.",
          "We hurried to finish.",
          "The dog hurried after the cat."
        ]
      },
      "through": {
        def: "Going in one side and out the other.",
        ex: [
          "He walked through the door.",
          "She ran through the park.",
          "The ball rolled through the gate.",
          "We drove through the city.",
          "The sun shines through the window.",
          "The dog ran through the grass."
        ]
      },
      "rows": {
        def: "More than one row; lines of things.",
        ex: [
          "The chairs are in rows.",
          "There are rows of flowers.",
          "We sit in rows at school.",
          "The corn grows in rows.",
          "The books are in rows.",
          "She planted rows of carrots."
        ]
      },
      "dreaming": {
        def: "Thinking about nice things while asleep or awake.",
        ex: [
          "She is dreaming of summer.",
          "He is dreaming about his birthday.",
          "I am dreaming of ice cream.",
          "They are dreaming of fun times.",
          "The dog is dreaming while he sleeps.",
          "We are dreaming of a trip."
        ]
      },
      "home": {
        def: "The place where you live.",
        ex: [
          "I go home after school.",
          "She loves her home.",
          "He is at home now.",
          "We play at home.",
          "The dog waits at home.",
          "Home is where my family is."
        ]
      },
      "and": {
        def: "Connects words or groups of words.",
        ex: [
          "I have a cat and a dog.",
          "She likes apples and bananas.",
          "He runs and jumps.",
          "We sing and dance.",
          "The sun and the moon are in the sky.",
          "Mom and dad are home."
        ]
      },
      "safety": {
        def: "Being safe from harm or danger.",
        ex: [
          "Wear a helmet for safety.",
          "Safety is important.",
          "We talk about safety at school.",
          "The seatbelt keeps you in safety.",
          "She cares about safety.",
          "Safety comes first."
        ]
      }
    };

    // Helper for finding the sentence containing a word
    function getSentenceForWord(wordSpan) {
      const storyText = document.getElementById('storyText').textContent;
      const text = storyText.replace(/\s+/g, ' ');
      const word = wordSpan.textContent;
      // Find the sentence containing the word (simple split by .)
      const sentences = text.split(/(?<=[.?!])\s+/);
      for (let s of sentences) {
        if (s.includes(word)) return s.trim();
      }
      return '';
    }

    // Helper: escape HTML
    function esc(str) {
      return str.replace(/[&<>]/g, c => ({
        '&':'&amp;','<':'&lt;','>':'&gt;'
      }[c]));
    }

    // Remove all popups and highlights
    function closeAllPopups() {
      document.querySelectorAll('.popup').forEach(p => p.remove());
      document.querySelectorAll('.uword.active').forEach(w => w.classList.remove('active'));
    }

    // Position popup below the underlined word, inside #story
    function positionPopup(wordSpan, popup) {
      const story = document.getElementById('story');
      const storyRect = story.getBoundingClientRect();
      const wordRect = wordSpan.getBoundingClientRect();
      // Find the top position: bottom of word relative to #story
      let top = wordRect.bottom - storyRect.top + 4; // 4px gap
      // Horizontal: popup is centered in #story
      let left = storyRect.width/2;
      popup.style.top = `${top}px`;
      popup.style.left = `${left}px`;
      popup.style.transform = 'translateX(-50%)';
      // Make sure popup stays inside #story vertically
      const popupRect = popup.getBoundingClientRect();
      let maxTop = storyRect.height - popup.offsetHeight - 8;
      if (top > maxTop) {
        popup.style.top = `${Math.max(0, maxTop)}px`;
      }
    }

    // Position secondary popup below the clicked definition, inside #story
    function positionDefPopup(defBtn, popup) {
      const story = document.getElementById('story');
      const storyRect = story.getBoundingClientRect();
      const defRect = defBtn.getBoundingClientRect();
      let top = defRect.bottom - storyRect.top + 4;
      let left = storyRect.width/2;
      popup.style.top = `${top}px`;
      popup.style.left = `${left}px`;
      popup.style.transform = 'translateX(-50%)';
      // Keep inside story
      let maxTop = storyRect.height - popup.offsetHeight - 8;
      if (top > maxTop) {
        popup.style.top = `${Math.max(0, maxTop)}px`;
      }
    }

    // Show popup for a non-preposition word
    function showWordPopup(wordSpan, word) {
      closeAllPopups();
      wordSpan.classList.add('active');
      const popup = document.createElement('div');
      popup.className = 'popup';
      popup.innerHTML = `
        <button class="close-btn" aria-label="Close popup" tabindex="0">✕</button>
        <div class="popup-word">${esc(word)}</div>
        <div class="popup-def">${esc(wordDict[word].def)}</div>
        <div class="popup-examples">
          ${wordDict[word].ex.map(e => `<div class="popup-example">${esc(e)}</div>`).join('')}
        </div>
      `;
      document.getElementById('story').appendChild(popup);
      positionPopup(wordSpan, popup);
      popup.querySelector('.close-btn').onclick = closeAllPopups;
    }

    // Show popup for a preposition word
    function showPrepPopup(wordSpan, word) {
      closeAllPopups();
      wordSpan.classList.add('active');
      const popup = document.createElement('div');
      popup.className = 'popup';
      // Find all definitions for this preposition
      const defs = jasonPreps[word.toLowerCase()];
      // Get the story sentence for this word
      const sentence = getSentenceForWord(wordSpan);
      // Underline the preposition in the sentence
      const prepRegex = new RegExp(`\\b${word}\\b`, 'i');
      const underlinedSent = esc(sentence).replace(prepRegex, `<span style="text-decoration:underline;text-underline-offset:0.18em">${word}</span>`);
      popup.innerHTML = `
        <button class="close-btn" aria-label="Close popup" tabindex="0">✕</button>
        <div class="popup-word">${esc(word)}</div>
        <div class="popup-sentence">${underlinedSent}</div>
        <div class="popup-prompt">Pick the best meaning below.</div>
        <div class="popup-def-list">
          ${
            defs
              ? defs.map((d, i) =>
                `<button class="popup-def-choice" data-idx="${i}" tabindex="0">${esc(d.def)}</button>`
              ).join('')
              : `<button class="popup-def-choice" data-idx="0">${esc(wordDict[word].def)}</button>`
          }
        </div>
      `;
      document.getElementById('story').appendChild(popup);
      positionPopup(wordSpan, popup);
      popup.querySelector('.close-btn').onclick = closeAllPopups;
      // Add click event for definition choices
      popup.querySelectorAll('.popup-def-choice').forEach(btn => {
        btn.onclick = function(e) {
          e.stopPropagation();
          showPrepDefExamples(wordSpan, word, btn, parseInt(btn.getAttribute('data-idx')));
        };
      });
    }

    // Show popup with example sentences for a preposition definition
    function showPrepDefExamples(wordSpan, word, defBtn, defIdx) {
      // Remove any existing secondary popups
      document.querySelectorAll('.popup.def-popup').forEach(p => p.remove());
      // Get the definition and examples
      const defs = jasonPreps[word.toLowerCase()];
      let def, examples;
      if (defs && defs[defIdx]) {
        def = defs[defIdx].def;
        examples = defs[defIdx].examples;
      } else {
        def = wordDict[word].def;
        examples = wordDict[word].ex;
      }
      // Build the popup
      const popup = document.createElement('div');
      popup.className = 'popup def-popup';
      popup.innerHTML = `
        <button class="close-btn" aria-label="Close popup" tabindex="0">✕</button>
        <div class="popup-def">${esc(def)}</div>
        <div class="popup-examples">
          ${examples.map(e => `<div class="popup-example">${esc(e)}</div>`).join('')}
        </div>
      `;
      document.getElementById('story').appendChild(popup);
      positionDefPopup(defBtn, popup);
      popup.querySelector('.close-btn').onclick = closeAllPopups;
    }

    // Click handler for underlined words
    document.getElementById('storyText').addEventListener('click', function(e) {
      let target = e.target;
      if (!target.classList.contains('uword')) return;
      const word = target.getAttribute('data-word');
      const isPrep = target.hasAttribute('data-prep');
      if (isPrep && jasonPreps[word.toLowerCase()]) {
        showPrepPopup(target, word);
      } else if (isPrep) {
        // Preposition not in dictionary: treat as normal word
        showWordPopup(target, word);
      } else {
        showWordPopup(target, word);
      }
    });

    // Remove popups when clicking outside
    document.addEventListener('click', function(e) {
      if (!e.target.closest('.popup') && !e.target.classList.contains('uword')) {
        closeAllPopups();
      }
    });

    // Keyboard accessibility for close buttons
    document.addEventListener('keydown', function(e) {
      if (e.key === "Escape") closeAllPopups();
    });

    // Reposition popups on window resize
    window.addEventListener('resize', function() {
      const active = document.querySelector('.uword.active');
      const popup = document.querySelector('.popup:not(.def-popup)');
      if (active && popup) positionPopup(active, popup);
      const defBtn = document.querySelector('.popup-def-choice.selected');
      const defPopup = document.querySelector('.popup.def-popup');
      if (defBtn && defPopup) positionDefPopup(defBtn, defPopup);
    });
  </script>
</body>
</html>
