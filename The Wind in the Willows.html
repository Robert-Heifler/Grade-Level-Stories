<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>The Wind in the Willows - Story with Definitions</title>
<style>
  body {
    margin: 0; padding: 1em; font-family: Arial, sans-serif;
    background: #f0f8ff;
  }
  #story {
    font-size: 2em;
    font-weight: bold;
    line-height: 1.4;
    max-width: 800px;
    margin: auto;
    position: relative;
    background: #ffffff;
    padding: 1em 1.5em 5em 1.5em;
    border-radius: 10px;
    box-shadow: 0 0 15px rgba(0,0,0,0.1);
  }
  .word {
    text-decoration: underline;
    cursor: pointer;
    user-select: none;
    white-space: nowrap;
    position: relative;
  }
  .highlighted {
    background-color: #add8e6;
    border-radius: 3px;
  }
  #popup {
    position: absolute;
    background: #e6f2ff;
    border: 2px solid #3399ff;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    padding: 0.5em 1em 1em 1em;
    font-weight: bold;
    font-size: 1em;
    color: #003366;
    z-index: 1000;
    max-width: 100%;
    box-sizing: border-box;
  }
  #popup .close-btn {
    position: absolute;
    top: 0.2em;
    right: 0.4em;
    font-weight: bold;
    font-size: 1.2em;
    cursor: pointer;
    user-select: none;
    color: #003366;
  }
  #popup .word-title {
    text-align: center;
    font-weight: bolder;
    font-size: 1.2em;
    margin-top: 1.5em;
    margin-bottom: 0.3em;
  }
  #popup .definition {
    font-weight: bolder;
    margin-bottom: 0.6em;
    text-align: center;
  }
  #popup .examples {
    font-weight: normal;
    font-size: 0.9em;
    line-height: 1.3;
    margin-left: 0.5em;
  }
  #popup .examples li {
    margin-bottom: 0.3em;
  }
</style>
</head>
<body>
<div id="story" aria-label="Story text with clickable words">
  <span class="word" data-key="Mole">Mole</span> 
  <span class="word" data-key="was">was</span> 
  <span class="word" data-key="cleaning">cleaning</span> 
  <span class="word" data-key="his">his</span> 
  <span class="word" data-key="little">little</span> 
  <span class="word" data-key="home">home</span> 
  <span class="word" data-key="when">when</span> 
  <span class="word" data-key="he">he</span> 
  <span class="word" data-key="suddenly">suddenly</span> 
  <span class="word" data-key="felt">felt</span> 
  <span class="word" data-key="tired">tired</span> 
  <span class="word" data-key="of">of</span> 
  <span class="word" data-key="it">it</span> 
  <span class="word" data-key="all">all</span>. 
  <span class="word" data-key="He">He</span> 
  <span class="word" data-key="had">had</span> 
  <span class="word" data-key="been">been</span> 
  <span class="word" data-key="working">working</span> 
  <span class="word" data-key="hard">hard</span> 
  <span class="word" data-key="all">all</span> 
  <span class="word" data-key="morning">morning</span> 
  <span class="word" data-key="and">and</span> 
  <span class="word" data-key="now">now</span> 
  <span class="word" data-key="he">he</span> 
  <span class="word" data-key="wanted">wanted</span> 
  <span class="word" data-key="to">to</span> 
  <span class="word" data-key="see">see</span> 
  <span class="word" data-key="the">the</span> 
  <span class="word" data-key="world">world</span> 
  <span class="word" data-key="outside">outside</span>. 
  <span class="word" data-key="He">He</span> 
  <span class="word" data-key="put">put</span> 
  <span class="word" data-key="down">down</span> 
  <span class="word" data-key="his">his</span> 
  <span class="word" data-key="cleaning">cleaning</span> 
  <span class="word" data-key="tools">tools</span> 
  <span class="word" data-key="and">and</span> 
  <span class="word" data-key="made">made</span> 
  <span class="word" data-key="his">his</span> 
  <span class="word" data-key="way">way</span> 
  <span class="word" data-key="up">up</span> 
  <span class="word" data-key="the">the</span> 
  <span class="word" data-key="tunnel">tunnel</span> 
  <span class="word" data-key="to">to</span> 
  <span class="word" data-key="the">the</span> 
  <span class="word" data-key="outside">outside</span>. 
  <span class="word" data-key="The">The</span> 
  <span class="word" data-key="sunshine">sunshine</span> 
  <span class="word" data-key="was">was</span> 
  <span class="word" data-key="bright">bright</span> 
  <span class="word" data-key="and">and</span> 
  <span class="word" data-key="warm">warm</span> 
  <span class="word" data-key="on">on</span> 
  <span class="word" data-key="his">his</span> 
  <span class="word" data-key="fur">fur</span>. 
  <span class="word" data-key="Mole">Mole</span> 
  <span class="word" data-key="had">had</span> 
  <span class="word" data-key="never">never</span> 
  <span class="word" data-key="seen">seen</span> 
  <span class="word" data-key="so">so</span> 
  <span class="word" data-key="much">much</span> 
  <span class="word" data-key="green">green</span> 
  <span class="word" data-key="grass">grass</span> 
  <span class="word" data-key="and">and</span> 
  <span class="word" data-key="blue">blue</span> 
  <span class="word" data-key="sky">sky</span> 
  <span class="word" data-key="before">before</span>. 
  <span class="word" data-key="He">He</span> 
  <span class="word" data-key="walked">walked</span> 
  <span class="word" data-key="and">and</span> 
  <span class="word" data-key="walked">walked</span> 
  <span class="word" data-key="until">until</span> 
  <span class="word" data-key="he">he</span> 
  <span class="word" data-key="came">came</span> 
  <span class="word" data-key="to">to</span> 
  <span class="word" data-key="the">the</span> 
  <span class="word" data-key="river">river</span>, 
  <span class="word" data-key="something">something</span> 
  <span class="word" data-key="he">he</span> 
  <span class="word" data-key="had">had</span> 
  <span class="word" data-key="never">never</span> 
  <span class="word" data-key="seen">seen</span> 
  <span class="word" data-key="in">in</span> 
  <span class="word" data-key="his">his</span> 
  <span class="word" data-key="life">life</span>. 
  <span class="word" data-key="The">The</span> 
  <span class="word" data-key="water">water</span> 
  <span class="word" data-key="sparkled">sparkled</span> 
  <span class="word" data-key="in">in</span> 
  <span class="word" data-key="the">the</span> 
  <span class="word" data-key="sun">sun</span> 
  <span class="word" data-key="as">as</span> 
  <span class="word" data-key="it">it</span> 
  <span class="word" data-key="flowed">flowed</span> 
  <span class="word" data-key="past">past</span>. 
  <span class="word" data-key="Mole">Mole</span> 
  <span class="word" data-key="was">was</span> 
  <span class="word" data-key="so">so</span> 
  <span class="word" data-key="happy">happy</span> 
  <span class="word" data-key="that">that</span> 
  <span class="word" data-key="he">he</span> 
  <span class="word" data-key="sat">sat</span> 
  <span class="word" data-key="down">down</span> 
  <span class="word" data-key="on">on</span> 
  <span class="word" data-key="the">the</span> 
  <span class="word" data-key="bank">bank</span> 
  <span class="word" data-key="to">to</span> 
  <span class="word" data-key="watch">watch</span> 
  <span class="word" data-key="the">the</span> 
  <span class="word" data-key="water">water</span> 
  <span class="word" data-key="and">and</span> 
  <span class="word" data-key="the">the</span> 
  <span class="word" data-key="animals">animals</span> 
  <span class="word" data-key="that">that</span> 
  <span class="word" data-key="lived">lived</span> 
  <span class="word" data-key="there">there</span>.
</div>

<div id="popup" role="dialog" aria-modal="true" aria-hidden="true" style="display:none;">
  <span class="close-btn" role="button" aria-label="Close popup" tabindex="0">Ã—</span>
  <div class="word-title"></div>
  <div class="definition"></div>
  <ul class="examples"></ul>
</div>

<script>
(() => {
  const story = document.getElementById('story');
  const popup = document.getElementById('popup');
  const closeBtn = popup.querySelector('.close-btn');
  const wordTitle = popup.querySelector('.word-title');
  const definitionEl = popup.querySelector('.definition');
  const examplesEl = popup.querySelector('.examples');
  let highlightedWord = null;

  // Dictionary with definitions and 6 example sentences for each word/idiom/contraction
  // Definitions are context-sensitive, simple, and suitable for young readers.
  const dictionary = {
    "Mole": {
      definition: "A small, furry animal that lives underground and likes to dig tunnels.",
      examples: [
        "The mole digs tunnels under the ground.",
        "Mole has soft black fur.",
        "Mole likes to stay in his cozy home.",
        "Mole was curious about the river.",
        "The mole walked outside to see the sun.",
        "Mole met new friends by the river."
      ]
    },
    "was": {
      definition: "Used to talk about something that happened in the past.",
      examples: [
        "She was happy yesterday.",
        "The sun was bright this morning.",
        "He was tired after playing.",
        "The dog was sleeping all day.",
        "It was cold last night.",
        "The mole was cleaning his home."
      ]
    },
    "cleaning": {
      definition: "Making something free from dirt or mess.",
      examples: [
        "She is cleaning her room.",
        "Mole was cleaning his little home.",
        "Cleaning helps keep things nice.",
        "He is cleaning the table.",
        "Cleaning the house takes time.",
        "They are cleaning the park."
      ]
    },
    "his": {
      definition: "Belonging to a boy or man.",
      examples: [
        "This is his hat.",
        "He lost his keys.",
        "Mole cleaned his home.",
        "His dog is very friendly.",
        "He took his book to school.",
        "His coat is blue."
      ]
    },
    "little": {
      definition: "Small in size or amount.",
      examples: [
        "The little bird sang a song.",
        "Mole has a little home.",
        "She has a little cat.",
        "The little boy smiled.",
        "We saw a little frog.",
        "The little flower is pretty."
      ]
    },
    "home": {
      definition: "The place where someone lives.",
      examples: [
        "Mole lives in his home underground.",
        "I like my home.",
        "The bird flew back to its home.",
        "We went home after school.",
        "Home is where family is.",
        "She cleaned her home."
      ]
    },
    "when": {
      definition: "At the time that something happens.",
      examples: [
        "I smile when I am happy.",
        "Mole was cleaning when he felt tired.",
        "When it rains, we stay inside.",
        "She laughs when she plays.",
        "When the sun sets, it gets dark.",
        "He runs fast when he is excited."
      ]
    },
    "he": {
      definition: "Used to talk about a boy or man.",
      examples: [
        "He is my friend.",
        "He likes to play outside.",
        "Mole felt tired and went out.",
        "He saw the river for the first time.",
        "He sat down on the bank.",
        "He walked across the meadow."
      ]
    },
    "suddenly": {
      definition: "Happening quickly and without warning.",
      examples: [
        "Suddenly, the rain started.",
        "Mole suddenly felt tired.",
        "The cat suddenly jumped.",
        "Suddenly, the lights went out.",
        "She suddenly smiled.",
        "The wind suddenly blew hard."
      ]
    },
    "felt": {
      definition: "To have a feeling or emotion.",
      examples: [
        "Mole felt tired after cleaning.",
        "I felt happy today.",
        "She felt cold outside.",
        "He felt scared in the dark.",
        "We felt warm by the fire.",
        "They felt excited about the trip."
      ]
    },
    "tired": {
      definition: "Feeling like you need to rest or sleep.",
      examples: [
        "Mole was tired after working.",
        "I feel tired after running.",
        "She was tired at night.",
        "He felt tired after school.",
        "The dog looks tired.",
        "We get tired when we play a lot."
      ]
    },
    "of": {
      definition: "Showing what something belongs to or is about.",
      examples: [
        "A cup of water.",
        "The color of the sky.",
        "Mole was tired of cleaning.",
        "A box of toys.",
        "The sound of birds.",
        "A piece of cake."
      ]
    },
    "it": {
      definition: "Used to talk about a thing or idea already mentioned.",
      examples: [
        "I like it very much.",
        "Mole was tired of it all.",
        "It is sunny outside.",
        "Take it carefully.",
        "It is time to go.",
        "It looks nice."
      ]
    },
    "all": {
      definition: "Everything or every part.",
      examples: [
        "All the birds sing.",
        "Mole was tired of it all.",
        "She ate all the cookies.",
        "All the children played.",
        "He gave all his toys away.",
        "All the flowers are blooming."
      ]
    },
    "had": {
      definition: "Used to show something happened before now.",
      examples: [
        "He had a big lunch.",
        "Mole had been working hard.",
        "She had a red ball.",
        "They had fun at the park.",
        "I had a good day.",
        "We had a party yesterday."
      ]
    },
    "been": {
      definition: "Used to talk about something that happened before now.",
      examples: [
        "He has been busy all day.",
        "Mole had been working hard all morning.",
        "She has been to the store.",
        "They have been friends for years.",
        "I have been waiting here.",
        "We have been outside."
      ]
    },
    "working": {
      definition: "Doing a job or task.",
      examples: [
        "Mole had been working hard.",
        "She is working on her homework.",
        "He is working in the garden.",
        "They are working together.",
        "I am working on a project.",
        "We were working all morning."
      ]
    },
    "hard": {
      definition: "With a lot of effort or energy.",
      examples: [
        "Mole was working hard.",
        "She works hard every day.",
        "He studied hard for the test.",
        "They worked hard in the sun.",
        "I try hard to do my best.",
        "The dog worked hard to find the ball."
      ]
    },
    "morning": {
      definition: "The first part of the day when the sun rises.",
      examples: [
        "Mole worked hard all morning.",
        "The morning is bright and fresh.",
        "We eat breakfast in the morning.",
        "Birds sing in the morning.",
        "She plays outside in the morning.",
        "The sun rises in the morning."
      ]
    },
    "and": {
      definition: "Used to join words or ideas together.",
      examples: [
        "Mole was tired and wanted to go out.",
        "I like apples and bananas.",
        "She runs and jumps.",
        "We play and learn.",
        "He sings and dances.",
        "The sun is bright and warm."
      ]
    },
    "now": {
      definition: "At this time, right away.",
      examples: [
        "Mole now wanted to see the world.",
        "Now is the time to play.",
        "She is here now.",
        "We must go now.",
        "He is ready now.",
        "Now the sun is shining."
      ]
    },
    "wanted": {
      definition: "To wish for or desire something.",
      examples: [
        "Mole wanted to see the world.",
        "She wanted a new toy.",
        "He wanted to go outside.",
        "They wanted to play together.",
        "I wanted to help my friend.",
        "We wanted to eat lunch."
      ]
    },
    "to": {
      definition: "Used to show direction, place, or purpose.",
      examples: [
        "Mole wanted to see the world.",
        "Go to the park.",
        "She went to school.",
        "We like to read books.",
        "He came to the party.",
        "They walked to the river."
      ]
    },
    "see": {
      definition: "To use your eyes to look at something.",
      examples: [
        "Mole wanted to see the world.",
        "I see a bird in the tree.",
        "She sees the sun shining.",
        "We see flowers in the garden.",
        "He sees the river flowing.",
        "They see animals in the forest."
      ]
    },
    "the": {
      definition: "Used before a noun to show a specific thing.",
      examples: [
        "The sun is bright.",
        "Mole walked to the river.",
        "She saw the animals.",
        "We like the green grass.",
        "He found the blue sky.",
        "They sat on the bank."
      ]
    },
    "world": {
      definition: "The earth and everything on it.",
      examples: [
        "Mole wanted to see the world.",
        "The world is big and full of places.",
        "We live in a wonderful world.",
        "The world has many animals.",
        "She dreams about the world outside.",
        "He learns about the world every day."
      ]
    },
    "outside": {
      definition: "The area that is not inside a building or place.",
      examples: [
        "Mole went outside his home.",
        "We play outside in the sun.",
        "The birds sing outside.",
        "She looks outside the window.",
        "He likes to be outside.",
        "The flowers grow outside."
      ]
    },
    "put": {
      definition: "To move something to a place or position.",
      examples: [
        "Mole put down his tools.",
        "She put the book on the table.",
        "He put on his coat.",
        "They put the toys away.",
        "I put the cup on the shelf.",
        "We put the food in the basket."
      ]
    },
    "down": {
      definition: "From a higher place to a lower place.",
      examples: [
        "Mole put down his tools.",
        "The ball rolled down the hill.",
        "She sat down on the chair.",
        "He looked down at the river.",
        "The leaves fell down from the tree.",
        "They walked down the path."
      ]
    },
    "tools": {
      definition: "Objects used to do a job or fix things.",
      examples: [
        "Mole used cleaning tools.",
        "She has many tools in her box.",
        "He uses tools to fix the bike.",
        "They have gardening tools.",
        "I need tools to build a birdhouse.",
        "The tools help us work better."
      ]
    },
    "made": {
      definition: "To create or do something.",
      examples: [
        "Mole made his way up the tunnel.",
        "She made a picture with crayons.",
        "He made a sandcastle at the beach.",
        "They made cookies in the kitchen.",
        "I made a card for my friend.",
        "We made a path through the grass."
      ]
    },
    "way": {
      definition: "A path or road to go somewhere.",
      examples: [
        "Mole made his way up the tunnel.",
        "We found a way through the forest.",
        "She showed me the way home.",
        "He walked the way to school.",
        "They cleared the way for the car.",
        "I know the way to the park."
      ]
    },
    "up": {
      definition: "From a lower place to a higher place.",
      examples: [
        "Mole made his way up the tunnel.",
        "She climbed up the hill.",
        "He looked up at the sky.",
        "The bird flew up in the air.",
        "They went up the stairs.",
        "I reached up to the shelf."
      ]
    },
    "tunnel": {
      definition: "A long, narrow passage underground or through a hill.",
      examples: [
        "Mole came out of the tunnel.",
        "The train went through the tunnel.",
        "We walked in the dark tunnel.",
        "The rabbit ran through the tunnel.",
        "He found a tunnel under the tree.",
        "The tunnel was cool and quiet."
      ]
    },
    "sunshine": {
      definition: "The light and warmth that comes from the sun.",
      examples: [
        "The sunshine was bright and warm.",
        "We played in the sunshine.",
        "Sunshine makes flowers grow.",
        "She felt the sunshine on her face.",
        "The sunshine made the day nice.",
        "Mole enjoyed the warm sunshine."
      ]
    },
    "bright": {
      definition: "Giving a lot of light or shining strongly.",
      examples: [
        "The sunshine was bright.",
        "The stars are bright at night.",
        "She has bright eyes.",
        "The room is bright and clean.",
        "The bright colors are pretty.",
        "He saw a bright light."
      ]
    },
    "warm": {
      definition: "Having a comfortable or nice heat.",
      examples: [
        "The sunshine was warm on Mole's fur.",
        "She wore a warm coat.",
        "The soup is warm and tasty.",
        "We like warm weather.",
        "The fire made the room warm.",
        "He felt warm after running."
      ]
    },
    "on": {
      definition: "Touching or supported by a surface.",
      examples: [
        "The sunshine was warm on his fur.",
        "The book is on the table.",
        "She sat on the chair.",
        "The picture hangs on the wall.",
        "He put the hat on his head.",
        "The cat is on the roof."
      ]
    },
    "fur": {
      definition: "The soft hair that covers an animal's body.",
      examples: [
        "Mole has black fur.",
        "The dog has soft fur.",
        "She petted the cat's fur.",
        "The bear's fur is thick.",
        "The rabbit's fur is white.",
        "Animals keep warm with fur."
      ]
    },
    "never": {
      definition: "Not at any time, not ever.",
      examples: [
        "Mole had never seen a river before.",
        "I never eat candy before dinner.",
        "She never forgets her homework.",
        "He never goes to bed late.",
        "They never play in the rain.",
        "We never leave the door open."
      ]
    },
    "seen": {
      definition: "To have looked at or noticed something.",
      examples: [
        "Mole had never seen the river.",
        "I have seen a rainbow.",
        "She has seen many animals.",
        "He saw the sunset yesterday.",
        "They have seen the new movie.",
        "We saw birds in the tree."
      ]
    },
    "so": {
      definition: "To a great degree or very much.",
      examples: [
        "Mole was so happy.",
        "The water sparkled so brightly.",
        "She was so tired after playing.",
        "He is so kind to friends.",
        "The sky is so blue today.",
        "We are so excited to go."
      ]
    },
    "much": {
      definition: "A large amount or number.",
      examples: [
        "Mole had never seen so much green grass.",
        "She has so much fun at school.",
        "He ate too much candy.",
        "There is much water in the river.",
        "We have much to learn.",
        "They gave me so much help."
      ]
    },
    "green": {
      definition: "The color of grass and leaves.",
      examples: [
        "The grass is green.",
        "Mole saw so much green grass.",
        "She wore a green dress.",
        "The leaves are green in spring.",
        "He likes green apples.",
        "We played on the green field."
      ]
    },
    "grass": {
      definition: "The small green plants that cover the ground outside.",
      examples: [
        "Mole saw green grass.",
        "We sit on the grass to play.",
        "The grass is soft and cool.",
        "She mowed the grass in the yard.",
        "The grass grows after rain.",
        "Animals eat the grass."
      ]
    },
    "blue": {
      definition: "The color of the sky on a clear day.",
      examples: [
        "Mole saw the blue sky.",
        "The sky is blue and bright.",
        "She has blue eyes.",
        "The blue bird sang a song.",
        "He wore a blue hat.",
        "The lake looks blue in the sun."
      ]
    },
    "sky": {
      definition: "The space above the earth where clouds and the sun are.",
      examples: [
        "Mole looked up at the sky.",
        "The sky is blue today.",
        "Birds fly in the sky.",
        "The sun shines in the sky.",
        "Stars twinkle in the night sky.",
        "Clouds move across the sky."
      ]
    },
    "before": {
      definition: "Earlier than now or something else.",
      examples: [
        "Mole had never seen a river before.",
        "I ate breakfast before school.",
        "She came here before me.",
        "He finished his work before lunch.",
        "They played outside before dinner.",
        "We saw the stars before sleeping."
      ]
    },
    "walked": {
      definition: "Moved by putting one foot in front of the other slowly or steadily.",
      examples: [
        "Mole walked to the river.",
        "She walked to school.",
        "He walked in the park.",
        "They walked home together.",
        "We walked on the path.",
        "The dog walked beside me."
      ]
    },
    "until": {
      definition: "Up to the time when something happens.",
      examples: [
        "Mole walked until he came to the river.",
        "We waited until the sun set.",
        "She stayed here until lunch.",
        "He played until it was dark.",
        "They worked until the end of the day.",
        "I read until I was tired."
      ]
    },
    "came": {
      definition: "Moved toward or arrived at a place.",
      examples: [
        "Mole came to the river.",
        "She came to my house.",
        "He came inside the room.",
        "They came to play with us.",
        "We came home after school.",
        "The rain came suddenly."
      ]
    },
    "river": {
      definition: "A large, flowing body of water.",
      examples: [
        "Mole saw the river for the first time.",
        "The river flows through the forest.",
        "We like to watch the river.",
        "Fish live in the river.",
        "The river water is cool.",
        "Boats float on the river."
      ]
    },
    "something": {
      definition: "A thing that is not named or known.",
      examples: [
        "Mole saw something new.",
        "I want to tell you something.",
        "She found something on the ground.",
        "He heard something in the night.",
        "They saw something moving.",
        "We need something to eat."
      ]
    },
    "life": {
      definition: "The time when a person, animal, or plant is alive.",
      examples: [
        "Mole had never seen a river in his life.",
        "Life is full of surprises.",
        "She loves the life outside.",
        "He enjoys life with his friends.",
        "Animals have different kinds of life.",
        "We learn about life every day."
      ]
    },
    "water": {
      definition: "A clear liquid that people, animals, and plants need to live.",
      examples: [
        "The water sparkled in the sun.",
        "We drink water every day.",
        "Fish live in the water.",
        "The river has fresh water.",
        "She poured water into the glass.",
        "Water helps plants grow."
      ]
    },
    "sparkled": {
      definition: "Shined with small flashes of light.",
      examples: [
        "The water sparkled in the sun.",
        "The stars sparkled at night.",
        "Her eyes sparkled with joy.",
        "The snow sparkled in the light.",
        "The jewels sparkled in the box.",
        "The lake sparkled in the morning."
      ]
    },
    "as": {
      definition: "At the same time or in the same way.",
      examples: [
        "The water sparkled as it flowed.",
        "She sings as she works.",
        "He runs as fast as he can.",
        "We laughed as we played.",
        "The sun shines as the birds sing.",
        "They danced as the music played."
      ]
    },
    "it": {
      definition: "Used to talk about a thing or idea already mentioned.",
      examples: [
        "The water sparkled in the sun as it flowed.",
        "It is a sunny day.",
        "I like it very much.",
        "It looks nice outside.",
        "Take it carefully.",
        "It is time to go."
      ]
    },
    "flowed": {
      definition: "Moved like a stream or river.",
      examples: [
        "The water flowed past the bank.",
        "The river flowed gently.",
        "The milk flowed into the glass.",
        "The wind flowed through the trees.",
        "The paint flowed down the wall.",
        "The river flowed all day long."
      ]
    },
    "past": {
      definition: "Moving by or beyond a place.",
      examples: [
        "The water flowed past the bank.",
        "We walked past the house.",
        "He ran past the school.",
        "The car drove past us.",
        "She looked past the trees.",
        "The dog ran past the gate."
      ]
    },
    "happy": {
      definition: "Feeling good and joyful.",
      examples: [
        "Mole was so happy.",
        "She is happy to see her friends.",
        "He felt happy playing outside.",
        "They were happy to help.",
        "I am happy today.",
        "The children are happy at school."
      ]
    },
    "that": {
      definition: "Used to show a thing or idea already mentioned.",
      examples: [
        "Mole was so happy that he sat down.",
        "I know that you are kind.",
        "She said that it was fun.",
        "He thinks that the sky is blue.",
        "They believe that the story is true.",
        "We hope that you like it."
      ]
    },
    "sat": {
      definition: "To rest with the bottom on a chair or the ground.",
      examples: [
        "Mole sat down on the bank.",
        "She sat on the chair.",
        "He sat by the fire.",
        "They sat together to eat.",
        "I sat next to my friend.",
        "The cat sat on the window."
      ]
    },
    "down": {
      definition: "From a higher place to a lower place.",
      examples: [
        "Mole sat down on the bank.",
        "The ball rolled down the hill.",
        "She sat down on the chair.",
        "He looked down at the river.",
        "The leaves fell down from the tree.",
        "They walked down the path."
      ]
    },
    "bank": {
      definition: "The land next to a river or lake.",
      examples: [
        "Mole sat on the bank of the river.",
        "We walked along the river bank.",
        "The fish swim near the bank.",
        "She picked flowers on the bank.",
        "The boat stayed close to the bank.",
        "He rested on the grassy bank."
      ]
    },
    "watch": {
      definition: "To look at something carefully.",
      examples: [
        "Mole watched the water and animals.",
        "She watches birds in the tree.",
        "He watches the clouds move.",
        "They watch the sun set.",
        "I watch the fish swim.",
        "We watch the stars at night."
      ]
    },
    "animals": {
      definition: "Living creatures that are not plants or people.",
      examples: [
        "Mole watched the animals by the river.",
        "Dogs and cats are animals.",
        "The forest has many animals.",
        "She likes to see animals at the zoo.",
        "Birds are animals that can fly.",
        "We learn about animals in school."
      ]
    },
    "that": {
      definition: "Used to show a thing or idea already mentioned.",
      examples: [
        "The animals that lived there were happy.",
        "I know that you like stories.",
        "She said that it was fun.",
        "He thinks that the sky is blue.",
        "They believe that the story is true.",
        "We hope that you like it."
      ]
    },
    "lived": {
      definition: "To have a home or place where you stay.",
      examples: [
        "The animals lived by the river.",
        "She lived in a big house.",
        "He lived in the city.",
        "They lived near the forest.",
        "I lived there last year.",
        "We lived happily together."
      ]
    },
    "there": {
      definition: "In or at that place.",
      examples: [
        "The animals lived there by the river.",
        "We went there yesterday.",
        "She is waiting there for us.",
        "He put the book there.",
        "They played there all day.",
        "I saw a bird there."
      ]
    }
  };

  // Verify all words in story have dictionary entries
  const wordsInStory = Array.from(story.querySelectorAll('.word')).map(w => w.dataset.key);
  wordsInStory.forEach(word => {
    if (!dictionary[word]) {
      // If missing, add a placeholder definition and examples
      dictionary[word] = {
        definition: "No definition available.",
        examples: [
          "No example sentence 1.",
          "No example sentence 2.",
          "No example sentence 3.",
          "No example sentence 4.",
          "No example sentence 5.",
          "No example sentence 6."
        ]
      };
    }
  });

  function clearHighlight() {
    if (highlightedWord) {
      highlightedWord.classList.remove('highlighted');
      highlightedWord = null;
    }
  }

  function closePopup() {
    popup.style.display = 'none';
    popup.setAttribute('aria-hidden', 'true');
    clearHighlight();
  }

  function positionPopup(clickedWord) {
    const wordRect = clickedWord.getBoundingClientRect();
    const storyRect = story.getBoundingClientRect();

    // Calculate top: about 2em below bottom of clicked word relative to story container
    // Use bounding rects only, no window scroll offsets
    const lineHeightPx = parseFloat(getComputedStyle(story).fontSize) * 1.4; // line height approx 1.4
    const twoLinesPx = lineHeightPx * 2;

    // top relative to story top
    let top = wordRect.bottom - storyRect.top + twoLinesPx;

    // width: nearly full width of story minus about 3-4 characters padding (~0.6em each)
    // We'll use 3.5em total horizontal padding inside popup
    const storyPaddingH = parseFloat(getComputedStyle(story).paddingLeft) + parseFloat(getComputedStyle(story).paddingRight);
    const storyWidth = story.clientWidth; // content width inside story container
    const popupMaxWidth = storyWidth - 48; // 48px ~ 3em padding (adjusted for clarity)
    popup.style.maxWidth = popupMaxWidth + 'px';

    // horizontally center popup inside story container
    // popup width will be close to max width, so left = (storyWidth - popupWidth)/2
    // but popup width is not fixed, so set left after setting maxWidth and measuring
    popup.style.top = top + 'px';
    popup.style.left = '0px'; // reset to measure
    popup.style.width = 'auto';
    popup.style.display = 'block';
    popup.setAttribute('aria-hidden', 'false');

    // After display block, measure popup width
    const popupWidth = popup.offsetWidth;
    let left = (storyWidth - popupWidth) / 2;

    // Ensure popup stays inside story horizontally
    if (left < 0) left = 0;
    if (left + popupWidth > storyWidth) left = storyWidth - popupWidth;

    popup.style.left = left + 'px';

    // Ensure popup bottom does not go beyond story container bottom
    const popupRect = popup.getBoundingClientRect();
    const popupBottomRelative = popupRect.bottom - storyRect.top;
    const storyHeight = story.clientHeight;
    if (popupBottomRelative > storyHeight) {
      // Move popup up if needed
      let newTop = top - (popupBottomRelative - storyHeight);
      if (newTop < wordRect.bottom - storyRect.top) {
        newTop = wordRect.bottom - storyRect.top; // at least below word bottom
      }
      popup.style.top = newTop + 'px';
    }
  }

  function showPopup(clickedWord) {
    clearHighlight();
    highlightedWord = clickedWord;
    clickedWord.classList.add('highlighted');

    const key = clickedWord.dataset.key;
    const entry = dictionary[key];

    wordTitle.textContent = key;
    definitionEl.textContent = entry.definition;
    examplesEl.innerHTML = '';
    entry.examples.forEach(sentence => {
      const li = document.createElement('li');
      li.textContent = sentence;
      examplesEl.appendChild(li);
    });

    positionPopup(clickedWord);
  }

  story.addEventListener('click', e => {
    if (e.target.classList.contains('word')) {
      if (highlightedWord === e.target) {
        closePopup();
      } else {
        showPopup(e.target);
      }
    }
  });

  closeBtn.addEventListener('click', closePopup);
  closeBtn.addEventListener('keydown', e => {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      closePopup();
    }
  });

  // Close popup if clicking outside story or popup
  document.addEventListener('click', e => {
    if (!story.contains(e.target) && !popup.contains(e.target)) {
      closePopup();
    }
  });

  // Adjust popup position on window resize or story scroll
  window.addEventListener('resize', () => {
    if (highlightedWord) {
      positionPopup(highlightedWord);
    }
  });

  story.addEventListener('scroll', () => {
    if (highlightedWord) {
      positionPopup(highlightedWord);
    }
  });
})();
</script>
</body>
</html>
